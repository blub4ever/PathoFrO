<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
>

<h:head>
    <title><h:outputFormat
            value="#{msg['dialog.archiveTask.headline']}"/></title>
    <h:outputStylesheet name="style.css" value="style.css" library="css"/>
    <h:outputStylesheet name="specificStyle.css" value="specificStyle.css"
                        library="css"/>
    <h:outputScript library="scripts" name="commonFunctions.js"/>
</h:head>

<h:body styleClass="histoDialogStyle">

    <h:form id="dialogContent">

        <div class="dialogHeader">
            <h:panelGrid style="width:100%;" columns="2"
                         styleClass="defaultHistoTable">
                <h:outputLabel value="#{msg['dialog.archiveTask.headline']}"/>
                <p:commandLink title="#{msg['general.close']}" style="float:right;"
                               onclick="$('#dialogContent\\:closeBtn').click();return false;">
                    <i class="fa fa-fw fa-times"/>
                </p:commandLink>
            </h:panelGrid>
        </div>

        <div class="dialogContent">

            <h:panelGrid columns="2" columnClasses="columnWidthPercent50 columnTop, columnWidthPercent50 columnTop"
                         styleClass="defaultHistoHiddenTableContainer" style="width: 100%">

                <!-- left column -->
                <h:panelGrid columns="1" styleClass="defaultHistoHiddenTableContainer" style="width: 100%;">

                    <!-- staining -->
                    <h:panelGrid columns="1" styleClass="defaultHistoSeperatorTable">
                        <h:outputLabel value="#{msg['dialog.archiveTask.status.staining.text']}"/>
                    </h:panelGrid>

                    <h:panelGrid columns="2" styleClass="defaultHistoTable" style="margin-left: 10px;"
                                 columnClasses="columnWidth250">

                        <!-- stainingphase -->
                        <h:outputLabel value="#{msg['dialog.archiveTask.status.staining.phase.text']} "/>
                        <h:panelGroup id="stainingDate">
                            <i class="fa fa-fw #{archiveTaskDialog.status.stainingStatus.completed ? 'fa-check-circle icon-green' : 'fa-times-circle icon-red'}"/>
                            <h:outputFormat style="margin-left: 5px"
                                            value="#{archiveTaskDialog.status.stainingStatus.dateOfCompletion}"
                                            rendered="#{archiveTaskDialog.status.stainingStatus.completed}">
                                <f:converter converterId="instantDateTimeConverter"/>
                                <f:attribute name="pattern" value="dd.MM.yyyy HH:mm:ss"/>
                            </h:outputFormat>

                            <p:tooltip for="stainingDate">
                                <h:outputLabel value="#{msg['dialog.archiveTask.status.staining.phase.completed']} "
                                               rendered="#{archiveTaskDialog.status.stainingStatus.completed}"/>

                                <h:outputLabel value="#{msg['dialog.archiveTask.status.staining.phase.notCompleted']}"
                                               rendered="#{!archiveTaskDialog.status.stainingStatus.completed}"/>
                            </p:tooltip>
                        </h:panelGroup>

                        <!-- slide status -->
                        <h:outputLabel value="#{msg['dialog.archiveTask.status.staining.slides.text']}"/>
                        <h:panelGroup id="stainingCompleted">
                            <i class="fa fa-fw #{archiveTaskDialog.taskStatus.stainingCompleted ? 'fa-check-circle icon-green' : 'fa-times-circle icon-red'}"/>
                            <p:tooltip for="stainingCompleted">
                                <h:outputText
                                        value="#{msg['dialog.archiveTask.status.staining.slides.completed']}"
                                        rendered="#{archiveTaskDialog.status.stainingStatus.allSlidesCompleted}"/>
                                <h:outputLabel
                                        value="#{msg['dialog.archiveTask.status.staining.slides.notCompleted']}"
                                        rendered="#{!archiveTaskDialog.status.stainingStatus.allSlidesCompleted}"/>
                            </p:tooltip>
                        </h:panelGroup>
                    </h:panelGrid>

                    <!-- slides -->
                    <h:panelGrid styleClass="defaultHistoTable" style="margin-left: 10px;">
                        <p:accordionPanel activeIndex="-1"
                                          styleClass="contentAccordionPannel" style="width:450px">

                            <p:tab title="#{msg['dialog.archiveTask.status.staining.details.text']}">
                                <p:dataTable styleClass="defaultHistoDataTable" style="width: auto"
                                             value="#{archiveTaskDialog.status.stainingStatus.slides}" var="slide">
                                    <!-- name -->
                                    <p:column
                                            headerText="#{msg['dialog.archiveTask.status.staining.details.list.name']}">
                                        <h:outputText value="#{slide.name}"/>
                                    </p:column>

                                    <p:column style="width:120px"
                                              styleClass="centerChildElements centerHeaderChildElements"
                                              headerText="#{msg['dialog.archiveTask.status.staining.details.list.status']}">
                                        <h:panelGroup id="stainingStatus">
                                            <i class="fa fa-fw #{slide.completed ? 'fa-check-circle icon-green' : 'fa-times-circle icon-red'}"/>
                                            <h:outputFormat style="margin-left: 5px" rendered="#{slide.completed}"
                                                            value="#{slide.dateOfCompletion}">
                                                <f:convertDateTime type="date"/>
                                            </h:outputFormat>

                                            <p:tooltip for="stainingStatus">
                                                <h:outputText
                                                        value="#{msg['dialog.archiveTask.status.staining.details.list.completed']} "
                                                        rendered="#{slide.completed}"/>
                                                <h:outputLabel
                                                        value="#{msg['dialog.archiveTask.status.staining.details.list.notCompleted']}"
                                                        rendered="#{!slide.completed}"/>
                                            </p:tooltip>
                                        </h:panelGroup>
                                    </p:column>
                                </p:dataTable>
                            </p:tab>
                        </p:accordionPanel>
                    </h:panelGrid>

                    <!-- diangoses -->
                    <h:panelGrid columns="1" styleClass="defaultHistoSeperatorTable">
                        <p:separator/>
                        <h:outputLabel value="#{msg['dialog.archiveTask.status.diagnoses.text']}"/>
                    </h:panelGrid>

                    <h:panelGrid columns="2" styleClass="defaultHistoTable" style="margin-left: 10px;"
                                 columnClasses="columnWidth250">
                        <!-- diagnosis phase -->
                        <h:outputLabel value="#{msg['dialog.archiveTask.status.diagnoses.phase.text']} "/>
                        <h:panelGroup id="diagnosisDate">
                            <i class="fa fa-fw #{archiveTaskDialog.status.diagnosisStatus.completed ? 'fa-check-circle icon-green' : 'fa-times-circle icon-red'}"/>
                            <h:outputFormat style="margin-left: 5px"
                                            value="#{archiveTaskDialog.status.diagnosisStatus.dateOfCompletion}"
                                            rendered="#{archiveTaskDialog.status.diagnosisStatus.completed}">
                                <f:converter converterId="instantDateTimeConverter"/>
                                <f:attribute name="pattern" value="dd.MM.yyyy HH:mm:ss"/>
                            </h:outputFormat>
                            <p:tooltip for="diagnosisDate">
                                <h:outputLabel value="#{msg['dialog.archiveTask.status.diagnoses.phase.completed']}"
                                               rendered="#{archiveTaskDialog.taskStatus.diagnosisPhaseCompleted}"/>
                                <h:outputLabel value="#{msg['dialog.archiveTask.status.diagnoses.phase.notCompleted']}"
                                               rendered="#{!archiveTaskDialog.taskStatus.diagnosisPhaseCompleted}"/>
                            </p:tooltip>
                        </h:panelGroup>

                        <!-- diagnosis correct -->
                        <h:outputLabel value="#{msg['dialog.archiveTask.status.diagnoses.status.text']}"/>
                        <h:panelGroup id="diagnosisCompleted">
                            <i class="fa fa-fw #{archiveTaskDialog.status.diagnosisStatus.valid ? 'fa-check-circle icon-green' : 'fa-times-circle icon-red'}"/>
                            <p:tooltip for="diagnosisCompleted">
                                <h:outputText value="#{msg['dialog.archiveTask.status.diagnoses.status.completed']}"
                                              rendered="#{archiveTaskDialog.status.diagnosisStatus.valid }"/>
                                <h:outputLabel value="#{msg['dialog.archiveTask.status.diagnoses.status.notCompleted']}"
                                               rendered="#{!archiveTaskDialog.status.diagnosisStatus.valid }"/>
                            </p:tooltip>
                        </h:panelGroup>
                    </h:panelGrid>

                    <!-- diagnoses -->
                    <h:panelGrid styleClass="defaultHistoTable" style="margin-left: 10px;">
                        <p:accordionPanel activeIndex="-1"
                                          styleClass="contentAccordionPannel" style="width:450px">
                            <p:tab title="#{msg['dialog.archiveTask.status.diagnoses.details.text']}">
                                <p:dataTable styleClass="defaultHistoDataTable"
                                             value="#{archiveTaskDialog.status.diagnosisStatus.revisions}" var="diagnosis">
                                    <!-- name -->
                                    <p:column
                                            headerText="#{msg['dialog.archiveTask.status.diagnoses.status.list.name']}">
                                        <h:outputText value="#{diagnosis.name}"/>
                                    </p:column>

                                    <!-- completed -->
                                    <p:column styleClass="centerChildElements"
                                              headerText="#{msg['dialog.archiveTask.status.diagnoses.status.list.completed']}">
                                        <h:panelGroup id="diangosisC">
                                            <i class="fa fa-fw #{diagnosis.completed ? 'fa-check-circle icon-green' : 'fa-times-circle icon-red'}"/>
                                            <p:tooltip for="diangosisC">
                                                <h:outputText
                                                        value="#{msg['dialog.archiveTask.status.diagnoses.status.list.completed.true']}"
                                                        rendered="#{diagnosis.completed}"/>
                                                <h:outputLabel
                                                        value="#{msg['dialog.archiveTask.status.diagnoses.status.list.completed.false']}"
                                                        rendered="#{!diagnosis.completed and !diagnosis.notificationStatus.ignore}"/>
                                            </p:tooltip>
                                        </h:panelGroup>
                                    </p:column>

                                    <!-- signature -->
                                    <p:column styleClass="centerChildElements"
                                              headerText="#{msg['dialog.archiveTask.status.diagnoses.status.list.signature']}">
                                        <h:panelGroup id="diangosisS">
                                            <i class="fa fa-fw #{diagnosis.signature ? 'fa-check-circle icon-green' : 'fa-times-circle icon-red'}"/>
                                            <p:tooltip for="diangosisS">
                                                <h:outputText
                                                        value="#{msg['dialog.archiveTask.status.diagnoses.status.list.signature.true']}"
                                                        rendered="#{diagnosis.signature}"/>
                                                <h:outputLabel
                                                        value="#{msg['dialog.archiveTask.status.diagnoses.status.list.signature.false']}"
                                                        rendered="#{!diagnosis.signature and !diagnosis.notificationStatus.ignore}"/>
                                            </p:tooltip>
                                        </h:panelGroup>
                                    </p:column>

                                    <!-- ignore -->
                                    <p:column styleClass="centerChildElements"
                                              headerText="#{msg['dialog.archiveTask.status.diagnoses.status.list.ignore']}">
                                        <h:panelGroup id="diangosisIgnore"
                                                      rendered="#{diagnosis.notificationStatus.ignore}">
                                            <i class="fa fa-fw fa-check-circle icon-green}"/>
                                            <p:tooltip for="diangosisIgnore">
                                                <h:outputText
                                                        value="#{msg['dialog.archiveTask.status.diagnoses.status.list.ignore.true']}"
                                                />
                                            </p:tooltip>
                                        </h:panelGroup>
                                    </p:column>

                                    <!-- notification performed -->
                                    <p:column styleClass="centerChildElements"
                                              headerText="#{msg['dialog.archiveTask.status.diagnoses.status.list.notification']}">
                                        <h:panelGroup id="diangosisNotification">
                                            <i class="fa fa-fw #{diagnosis.notificationStatus.performed ? 'fa-check-circle icon-green' : 'fa-times-circle icon-red'}"/>
                                            <p:tooltip for="diangosisNotification">
                                                <h:outputText
                                                        value="#{msg['dialog.archiveTask.status.diagnoses.status.list.ignore.true']}"
                                                        rendered="#{diagnosis.notificationStatus.performed}"/>
                                                <h:outputText
                                                        value="#{msg['dialog.archiveTask.status.diagnoses.status.list.ignore.true']}"
                                                        rendered="#{!diagnosis.notificationStatus.performed and !diagnosis.notificationStatus.ignore}"/>
                                            </p:tooltip>
                                        </h:panelGroup>
                                    </p:column>

                                </p:dataTable>
                            </p:tab>
                        </p:accordionPanel>
                    </h:panelGrid>
                </h:panelGrid>

                <!-- right column -->
                <h:panelGrid columns="1" styleClass="defaultHistoHiddenTableContainer">
                    <!-- notification -->
                    <h:panelGrid columns="1" styleClass="defaultHistoSeperatorTable">
                        <h:outputLabel value="#{msg['dialog.archiveTask.status.notification']}"/>
                    </h:panelGrid>

                    <h:panelGrid columns="2" styleClass="defaultHistoTable" style="margin-left: 10px;"
                                 columnClasses="columnWidth175">
                        <!-- notification phase -->
                        <h:outputLabel value="#{msg['dialog.archiveTask.status.notification.phase']} "/>
                        <h:panelGroup id="notificationDate">
                            <i class="fa fa-fw #{archiveTaskDialog.taskStatus.notificationPhaseCompleted? 'fa-check-circle icon-green' : 'fa-times-circle icon-red'}"/>
                            <p:tooltip for="notificationDate">
                                <h:outputLabel value="#{msg['dialog.archiveTask.status.notification.phase.true']}"
                                               rendered="#{archiveTaskDialog.taskStatus.notificationPhaseCompleted}"/>
                                <h:outputLabel
                                        value="#{msg['dialog.archiveTask.status.notification.phase.false']}"
                                        rendered="#{!archiveTaskDialog.taskStatus.notificationPhaseCompleted}"/>
                            </p:tooltip>
                        </h:panelGroup>
                    </h:panelGrid>

                    <!-- notifications -->
                    <h:panelGrid styleClass="defaultHistoTable" style="margin-left: 10px;">
                        <p:accordionPanel activeIndex="#{archiveTaskDialog.taskStatus.diagnosisAccordionIndex}"
                                          styleClass="contentAccordionPannel" style="width:450px">
                            <p:tab title="#{msg['dialog.archiveTask.status.notification.status']}">

                                <p:dataTable styleClass="defaultHistoDataTable"
                                             value="#{archiveTaskDialog.taskStatus.notificationsStatus}"
                                             var="notification">

                                    <p:columnGroup type="header">
                                        <p:row>
                                            <p:column>
                                                <h:outputText value="as#{notification.contact.person.getFullName()}"/>
                                            </p:column>
                                        </p:row>
                                    </p:columnGroup>

                                    <p:subTable var="stats" value="#{notification.notifications}">
                                        <p:column headerText="Typ">
                                            <h:outputText value="#{stats.type}"/>
                                        </p:column>
                                    </p:subTable>

                                </p:dataTable>
                            </p:tab>
                        </p:accordionPanel>
                    </h:panelGrid>


                    <!-- councils -->
                    <h:panelGrid columns="1" styleClass="defaultHistoSeperatorTable">
                        <p:separator/>
                        <h:outputLabel value="#{msg['dialog.archiveTask.status.diagnoses']}"/>
                    </h:panelGrid>

                    <!-- miscellaneous -->
                    <h:panelGrid columns="1" styleClass="defaultHistoSeperatorTable">
                        <p:separator/>
                        <h:outputLabel value="#{msg['dialog.archiveTask.status.diagnoses']}"/>
                    </h:panelGrid>
                </h:panelGrid>
            </h:panelGrid>
        </div>

        <div class="buttonContainer">
            <h:panelGrid columns="2">

                <h:panelGrid columns="1" styleClass="left">
                </h:panelGrid>

                <h:panelGrid columns="2" styleClass="right">
                    <!-- Save button -->
                    <p:commandButton
                            value="#{msg['dialog.archiveTask.button.archive']}"
                            icon="fa fa-archive">
                        <f:actionListener
                                binding="#{archiveTaskDialog.archiveTask()}"></f:actionListener>
                        <f:actionListener
                                binding="#{archiveTaskDialog.hideDialog()}"></f:actionListener>
                    </p:commandButton>

                    <!-- Close button -->
                    <p:commandButton value="#{msg['general.abort']}" id="closeBtn"
                                     icon="fa fa-times-circle" actionListener="#{archiveTaskDialog.hideDialog()}">
                    </p:commandButton>
                </h:panelGrid>
            </h:panelGrid>
        </div>


    </h:form>
</h:body>
</html>