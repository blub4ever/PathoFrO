<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
>

    <p:outputPanel styleClass="headerPannel">
        <h:outputLabel
                value="#{msg['dialog.notification.tab.general.headline']}"/>
    </p:outputPanel>


    <p:outputPanel styleClass="bodyPannel">

        <!-- diagnoses -->
        <h:panelGrid columns="2" styleClass="defaultHistoTable"
                     columnClasses="columnWidth150 columnTop,">

            <!-- Notifications -->
            <h:outputLabel
                    value="#{msg['dialog.notification.tab.general.diagnosis']}"
                    styleClass="bigFont"/>

            <h:panelGroup>
                <p:dataTable var="diangosis" id="diangosisList"
                             scrollHeight="100" styleClass="defaultHistoDataTable"
                             scrollable="true" selectionMode="single"
                             rowKey="#{diangosis.diagnosisRevision.id}"
                             selection="#{notificationDialog.generalTab.selectDiagnosisRevision}"
                             value="#{notificationDialog.generalTab.diagnosisRevisions}">

                    <!-- Name -->
                    <p:column
                            headerText="#{msg['dialog.notification.tab.general.diagnosis.table.name']}"
                            style="width:auto">
                        <h:outputText value="#{diangosis.diagnosisRevision.name}"/>
                        <p:commandLink
                                styleClass="diagnosisOverlayPanelyTrigger"
                                icon="pi pi-search"
                                actionListener="#{notificationDialog.generalTab.setViewDiagnosisRevisionDetails(diangosis)}"
                                partialSubmit="true"
                                process="@this"
                                update="adminForm:diagnosisOverlayPanel"
                                oncomplete="commonFunctions.showOverlayPanel('diagnosisOverlayPanel', '#{component.clientId}');">
                            <i class="fa fa-info-circle"/>
                        </p:commandLink>
                    </p:column>

                    <!-- pending -->
                    <p:column style="width:25%" styleClass="centerChildElements"
                              headerText="#{msg['dialog.notification.tab.general.diagnosis.table.notificationStatus']}">
                        <ui:fragment
                                rendered="#{diangosis.diagnosisRevision.notificationStatus eq 'NOT_APPROVED'}">
                            <i class="fa fa-fw fa-volume-off icon-red"
                               title="#{msg['dialog.notification.tab.general.diagnosis.table.notificationStatus.NOT_APPROVED']}"/>
                        </ui:fragment>
                        <ui:fragment
                                rendered="#{diangosis.diagnosisRevision.notificationStatus eq 'NOTIFICATION_PENDING'}">
                            <i class="fa fa-fw fa-volume-up icon-orange"
                               title="#{msg['dialog.notification.tab.general.diagnosis.table.notificationStatus.NOTIFICATION_PENDING']}"/>
                        </ui:fragment>
                        <ui:fragment
                                rendered="#{diangosis.diagnosisRevision.notificationStatus eq 'NO_NOTFICATION'}">
                            <i class="fa fa-fw fa-circle icon-red"
                               title="#{msg['dialog.notification.tab.general.diagnosis.table.notificationStatus.NO_NOTFICATION']}"/>
                        </ui:fragment>
                        <ui:fragment
                                rendered="#{diangosis.diagnosisRevision.notificationStatus eq 'NOTIFICATION_COMPLETED'}">
                            <i class="fa fa-fw fa-check-circle icon-green"
                               title="#{msg['dialog.notification.tab.general.diagnosis.table.notificationStatus.NOTIFICATION_COMPLETED']}"/>
                        </ui:fragment>
                    </p:column>

                    <!-- performed -->
                    <p:column style="width:20%"
                              headerText="#{msg['dialog.notification.tab.general.diagnosis.table.notificationPerformd']}">

                        <h:outputText value="#{diangosis.diagnosisRevision.notificationDate}"
                                      rendered="#{diangosis.diagnosisRevision.notificated}">
                            <f:converter converterId="instantDateTimeConverter"/>
                            <f:attribute name="pattern" value="dd.MM.yyyy HH:mm:ss"/>
                        </h:outputText>
                    </p:column>

                    <p:ajax event="rowSelect" process="@form" update="@form"
                            listener="#{notificationDialog.generalTab.onDiangosisSelect()}"/>
                </p:dataTable>

                <script type="text/javascript">
                    commonFunctions.addGlobalHideOverlayPanelOnMouseClickHandler('diagnosisOverlayPanel')
                    commonFunctions.addShowDialogOnMouseEnter(".diagnosisOverlayPanelyTrigger", "diagnosisOverlayPanel")
                </script>
                <!-- overlay for contact notifications -->
                <p:overlayPanel widgetVar="diagnosisOverlayPanel" hideEvent="null" showEvent="null"
                                dismissable="false" id="diagnosisOverlayPanel" styleClass="histoOverlayPanel">
                    <p:dataTable value="#{notificationDialog.generalTab.viewDiagnosisRevisionDetails.reportIntents}"
                                 var="reportIntent">
                        <p:column>
                            <h:outputLabel value="#{reportIntent.reportIntent.person.fullName}"/>

                        </p:column>
                    </p:dataTable>
                </p:overlayPanel>

            </h:panelGroup>
            <h:outputLabel value=" "/>
            <h:panelGroup>
                <!-- diagnosis not approved warning -->
                <h:outputLabel styleClass="icon-red bigFont"
                               value="#{msg['dialog.notification.tab.general.diagnosis.notApproved']}"
                               rendered="#{notificationDialog.generalTab.selectedDiagnosisNotApprovedy}"/>
                <!-- diagnosis select manually -->
                <h:outputLabel styleClass="icon-red bigFont"
                               value="#{msg['dialog.notification.tab.general.diagnosis.selectManually']}"
                               rendered="#{notificationDialog.generalTab.selectDiagnosisManually}"/>
            </h:panelGroup>

            <h:outputLabel
                    value="#{msg['dialog.notification.tab.general.completeNotification']}"/>
            <p:selectBooleanCheckbox
                    value="#{notificationDialog.generalTab.completeNotification}"
                    title="#{msg['dialog.notification.tab.general.completeNotification.tex']}">
                <p:ajax event="change" process="@this"/>
            </p:selectBooleanCheckbox>
        </h:panelGrid>

        <!-- Separator -->
        <h:panelGrid columns="1" styleClass="defaultHistoSeperatorTable">
            <p:separator/>
            <h:outputLabel
                    value="#{msg['dialog.notification.tab.general.notification']}"/>
        </h:panelGrid>

        <!-- additional prints -->
        <h:panelGrid columns="2" styleClass="defaultHistoTable"
                     columnClasses="columnWidth150,">
            <!-- Use additional prints-->
            <h:outputLabel value="#{msg['dialog.notification.tab.general.use']}"
                           styleClass="bigFont"/>
            <p:selectBooleanCheckbox
                    value="#{notificationDialog.generalTab.useNotification}"
                    title="#{msg['dialog.notification.tab.general.use.text']}">
                <p:ajax event="change" process="@form" update="@form"/>
            </p:selectBooleanCheckbox>

            <!-- additional prints -->
            <h:outputLabel styleClass="bigFont"
                           value="#{msg['dialog.notification.tab.general.additionalPrints.tempalte']}"/>
            <p:selectOneMenu panelStyleClass="iconFixForSelectOneMenu"
                             disabled="#{!notificationDialog.generalTab.useNotification}"
                             value="#{notificationDialog.generalTab.selectedTemplate}"
                             converter="#{notificationDialog.generalTab.templatesTransformer}">

                <f:selectItem itemValue="#{null}"
                              itemLabel="#{msg['dialog.notification.tab.mail.pdfTemplate.none']}"></f:selectItem>

                <f:selectItems
                        value="#{notificationDialog.generalTab.templates}"
                        var="template" itemLabel="#{template.name}" itemValue="#{template}"/>

                <p:ajax update="@this" event="change" process="@this"
                        partialSubmit="true"/>
            </p:selectOneMenu>

            <!-- print -->
            <h:outputLabel styleClass="bigFont"
                           value="#{msg['dialog.notification.tab.general.additionalPrints.count']} "
                           title="#{msg['dialog.notification.tab.send.count']}"/>
            <p:spinner
                    disabled="#{!notificationDialog.generalTab.useNotification}"
                    value="#{notificationDialog.generalTab.printCount}"
                    styleClass="oneNumberSpinner" min="0" max="9"/>
        </h:panelGrid>
    </p:outputPanel>

    <div class="buttonContainer">
        <h:panelGrid columns="2">
            <h:panelGrid columns="1" styleClass="left" id="toManyMatches">
            </h:panelGrid>

            <h:panelGrid columns="2" styleClass="right" id="buttonContainer">
                <!-- next -->
                <p:commandButton value="#{msg['general.next']}"
                                 icon="fa fa-fw fa-arrow-right"
                                 disabled="#{notificationDialog.generalTab.selectDiagnosisManually}"
                                 actionListener="#{notificationDialog.nextTab()}"
                                 process="@form" update="@form"/>

                <!-- close -->
                <p:commandButton value="#{msg['general.close']}"
                                 icon="fa fa-times-circle"
                                 actionListener="#{notificationDialog.hideDialog()}"/>
            </h:panelGrid>
        </h:panelGrid>
    </div>
</ui:composition>