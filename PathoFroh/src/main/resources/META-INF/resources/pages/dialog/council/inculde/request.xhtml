<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
>

    <p:outputPanel styleClass="headerPannel" id="header">
        <h:outputFormat value="#{msg['dialog.council.request']}"
                        escape="false">
            <f:param value="#{dialog.councilDialog.selectedCouncil.name}"/>
        </h:outputFormat>
    </p:outputPanel>

    <p:outputPanel styleClass="bodyPannel" style="padding:10px;">

        <h:panelGrid styleClass="defaultHistoTable" columns="2"
                     id="councilRequestData">

            <!-- name -->
            <h:outputLabel value="#{msg['dialog.council.name']}"></h:outputLabel>
            <h:outputLabel id="councilName"
                           value="#{dialog.councilDialog.selectedCouncil.name}"></h:outputLabel>

            <!-- requesting text -->
            <h:outputLabel value="#{msg['dialog.council.requestText']}"></h:outputLabel>
            <p:inputTextarea style="width: 700px;" rows="20"
                             disabled="#{(dialog.councilDialog.selectedCouncil.councilRequestCompleted and !dialog.councilDialog.selectedCouncil.forceEditRequest) or !dialog.councilDialog.selectedCouncil.task.taskStatus.editable}"
                             value="#{dialog.councilDialog.selectedCouncil.councilText}">
                <p:ajax event="keyup" delay="200" process="@form"
                        listener="#{dialog.councilDialog.saveSelectedCouncil()}"/>
            </p:inputTextarea>

            <!-- Consultant -->
            <h:outputLabel value="#{msg['dialog.council.consultant']}"></h:outputLabel>

            <h:panelGrid columns="2" style="width: auto"
                         styleClass="listingHistoHiddenTableContainer">

                <!-- council physician -->
                <p:selectOneMenu
                        value="#{dialog.councilDialog.selectedCouncil.councilPhysician}"
                        panelStyleClass="iconFixForSelectOneMenu"
                        disabled="#{(dialog.councilDialog.selectedCouncil.councilRequestCompleted and !dialog.councilDialog.selectedCouncil.forceEditRequest) or !dialog.councilDialog.selectedCouncil.task.taskStatus.editable}"
                        converter="#{dialog.councilDialog.physicianCouncilTransformer}"
                        filter="true" filterMatchMode="contains">

                    <f:selectItem
                            itemLabel="#{msg['dialog.council.consultant.choose']}"
                            itemValue="#{null}"/>

                    <f:selectItems value="#{dialog.councilDialog.physicianCouncilList}"
                                   var="physician" itemLabel="#{physician.person.getFullName()}"
                                   itemValue="#{physician}"/>

                    <p:ajax event="change" update="header councilName navigationTable"
                            process="@form" listener="#{dialog.councilDialog.onNameChange()}"/>

                </p:selectOneMenu>

                <!-- edit physicians -->
                <p:commandLink title="#{msg['dialog.council.consultant.edit']}"
                               style="margin-left:10px;" styleClass="noUnderlineAtLink icon-grey"
                               actionListener="#{dialog.settingsDialog.initAndPrepareBean('PhysicianSettingsTab')}">
                    <i class="fa fa-fw fa-cog icon-grey"/>
                    <p:ajax event="dialogReturn"
                            listener="#{dialog.councilDialog.updatePhysicianLists()}"/>
                </p:commandLink>

            </h:panelGrid>

            <!-- council requesting physician -->
            <h:outputLabel value="#{msg['dialog.council.physician.requesting']}"></h:outputLabel>
            <h:panelGrid columns="2" style="width: auto"
                         styleClass="listingHistoHiddenTableContainer">
                <!-- physician requesting council -->
                <p:selectOneMenu panelStyleClass="iconFixForSelectOneMenu"
                                 disabled="#{(dialog.councilDialog.selectedCouncil.councilRequestCompleted and !dialog.councilDialog.selectedCouncil.forceEditRequest) or !dialog.councilDialog.selectedCouncil.task.taskStatus.editable}"
                                 value="#{dialog.councilDialog.selectedCouncil.physicianRequestingCouncil}"
                                 converter="#{dialog.councilDialog.physicianSigantureListTransformer}"
                                 filter="true" filterMatchMode="contains">

                    <f:selectItem itemLabel="#{msg['dialog.council.physician.choose']}"
                                  itemValue="#{null}"/>

                    <f:selectItems
                            value="#{dialog.councilDialog.physicianSigantureList}"
                            var="physicianToSign"
                            itemLabel="#{physicianToSign.person.getFullName()}"
                            itemValue="#{physicianToSign}"/>

                    <p:ajax event="change" process="@form"
                            listener="#{dialog.councilDialog.saveSelectedCouncil()}"/>

                </p:selectOneMenu>

                <!-- edit physician list -->
                <p:commandLink title="#{msg['dialog.council.physician.edit']}"
                               style="margin-left:10px;" styleClass="noUnderlineAtLink"
                               actionListener="#{dialog.settingsDialog.initAndPrepareBean('PhysicianSettingsTab')}">
                    <i class="fa fa-fw fa-cog icon-grey"/>
                    <p:ajax event="dialogReturn" update="@form"
                            listener="#{dialog.councilDialog.updatePhysicianLists()}"/>
                </p:commandLink>
            </h:panelGrid>

            <!-- Date -->
            <h:outputLabel value="#{msg['dialog.council.date']}"></h:outputLabel>
            <p:calendar
                    disabled="#{(dialog.councilDialog.selectedCouncil.councilRequestCompleted and !dialog.councilDialog.selectedCouncil.forceEditRequest) or !dialog.councilDialog.selectedCouncil.task.taskStatus.editable}"
                    value="#{dialog.councilDialog.selectedCouncil.dateOfRequest}"
                    tabindex="4" locale="de" pattern="dd.MM.yyyy" mask="true">

                <p:ajax event="dateSelect"
                        update="header councilName navigationTable" process="@form"
                        listener="#{dialog.councilDialog.onNameChange()}"/>

                <p:ajax event="change" update="header councilName navigationTable"
                        process="@form" listener="#{dialog.councilDialog.onNameChange()}"/>
            </p:calendar>

            <!-- council request -->
            <h:outputLabel value="#{msg['dialog.council.shippingby']}"></h:outputLabel>
            <p:selectOneMenu panelStyleClass="iconFixForSelectOneMenu"
                             disabled="#{(dialog.councilDialog.selectedCouncil.councilRequestCompleted and !dialog.councilDialog.selectedCouncil.forceEditRequest) or !dialog.councilDialog.selectedCouncil.task.taskStatus.editable}"
                             value="#{dialog.councilDialog.selectedCouncil.notificationMethod}"
                             filter="true" filterMatchMode="contains">

                <f:selectItem
                        itemLabel="#{msg['enum.councilNotificationMethod.MTA']}"
                        itemValue="MTA"/>
                <f:selectItem
                        itemLabel="#{msg['enum.councilNotificationMethod.SECRETARY']}"
                        itemValue="SECRETARY"/>
                <f:selectItem
                        itemLabel="#{msg['enum.councilNotificationMethod.NONE']}"
                        itemValue="#{null}"/>

                <p:ajax event="change" process="@form"
                        listener="#{dialog.councilDialog.saveSelectedCouncil()}"/>

            </p:selectOneMenu>

            <h:outputLabel value="&nbsp;"/>
            <h:outputLabel value=" "/>

            <!-- internal commentary -->
            <h:outputLabel value="#{msg['dialog.council.internalCommentary']}"></h:outputLabel>
            <p:inputTextarea style="width: 700px;" rows="5"
                             disabled="#{!dialog.councilDialog.selectedCouncil.task.taskStatus.editable}"
                             value="#{dialog.councilDialog.selectedCouncil.commentary}">
                <p:ajax event="keyup" delay="200" process="@form"
                        listener="#{dialog.councilDialog.saveSelectedCouncil()}"/>
            </p:inputTextarea>

        </h:panelGrid>
    </p:outputPanel>

    <div class="buttonContainer">
        <h:panelGrid columns="2" style="width:100%"
                     styleClass="newTableContainer">

            <h:panelGrid columns="1" styleClass="newTableContainer left">
            </h:panelGrid>

            <h:panelGrid columns="3" styleClass="newTableContainer right">

                <h:panelGroup style="margin-right:30px;" id="customButtonContainer"
                              rendered="#{dialog.councilDialog.selectedCouncil.task.taskStatus.editable}">

                    <!-- finalize request -->
                    <p:commandButton
                            value="#{msg['dialog.council.button.sendRequest']}"
                            style="margin-right:30px" icon="fa fa-check-circle-o"
                            actionListener="#{quickDiagnosisRecordDialog.initAndPrepareBean(dialog.councilDialog.task,'DIAGNOSIS_COUNCIL').setInternalReference('c:'.concat(dialog.councilDialog.selectedCouncil.id))}"
                            rendered="#{!dialog.councilDialog.selectedCouncil.councilRequestCompleted}">
                        <p:ajax event="dialogReturn" update="@form"
                                listener="#{dialog.councilDialog.onEndRequestState}" />
                    </p:commandButton>

                    <!-- edit changes changes -->
                    <p:commandButton
                            value="#{msg['dialog.council.button.editRequest']}"
                            rendered="#{dialog.councilDialog.selectedCouncil.councilRequestCompleted and !dialog.councilDialog.selectedCouncil.forceEditRequest}"
                            icon="fa fa-check-circle-o"
                            update="councilRequestData dialogContent:customButtonContainer"
                            actionListener="#{dialog.councilDialog.selectedCouncil.setForceEditRequest(true)}">
                    </p:commandButton>

                    <!-- save changes changes -->
                    <p:commandButton
                            value="#{msg['dialog.council.button.saveRequest']}"
                            rendered="#{dialog.councilDialog.selectedCouncil.councilRequestCompleted and dialog.councilDialog.selectedCouncil.forceEditRequest}"
                            icon="fa fa-check-circle-o"
                            update="councilRequestData dialogContent:customButtonContainer"
                            actionListener="#{dialog.councilDialog.selectedCouncil.setForceEditRequest(false)}">
                    </p:commandButton>

                </h:panelGroup>

                <!-- print -->
                <p:commandButton value="#{msg['general.print']}"
                                 icon="fa fa-check-circle-o">
                    <f:actionListener
                            binding="#{dialog.councilDialog.printCouncilReport()}"/>
                </p:commandButton>

                <!-- Close Button -->
                <p:commandButton value="#{msg['general.close']}"
                                 widgetVar="closeBtn" icon="fa fa-times-circle" update="@form"
                                 immediate="true"
                                 actionListener="#{dialog.councilDialog.hideDialog()}"/>
            </h:panelGrid>
        </h:panelGrid>
    </div>
</ui:composition>
