<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui">

    <p:outputPanel styleClass="headerPannel">
        <h:outputLabel value="#{msg['dialog.notificationDialog.mail.headline']}"/>
    </p:outputPanel>

    <p:outputPanel styleClass="bodyPannel">
        <h:panelGrid columns="2" styleClass="defaultHistoTable"
                     columnClasses="columnWidth150 columnTop, ">

            <!-- Use Mail -->
            <h:outputLabel value="#{msg['dialog.notificationDialog.mail.use.text']}"
                           title="#{msg['dialog.notificationDialog.mail.use.info']}"
                           styleClass=" bigFont"/>
            <p:selectBooleanCheckbox
                    value="#{notificationDialog.mailTab.useNotification}"
                    title="#{msg['dialog.notificationDialog.mail.use.info']}">
                <p:ajax event="change" process="@this" update="@form"/>
            </p:selectBooleanCheckbox>

            <!-- subject -->
            <h:outputLabel value="#{msg['dialog.notificationDialog.mail.subject.text']}"
                           title="#{msg['dialog.notificationDialog.mail.subject.info']}"
                           styleClass="bigFont"/>
            <p:inputText
                    value="#{notificationDialog.mailTab.mailTemplate.finalSubject}"
                    title="#{msg['dialog.notificationDialog.mail.subject.info']}"
                    style="width:95%"
                    disabled="#{!notificationDialog.mailTab.useNotification}"/>

            <!-- Text -->
            <h:outputLabel value="#{msg['dialog.notificationDialog.mail.text.text']}"
                           title="#{msg['dialog.notificationDialog.mail.text.info']}"
                           styleClass="bigFont"/>
            <p:inputTextarea escape="false"
                             value="#{notificationDialog.mailTab.mailTemplate.finalBody}"
                             title="#{msg['dialog.notificationDialog.mail.text.info']}"
                             style="width:95%"
                             disabled="#{!notificationDialog.mailTab.useNotification}"
                             rows="10"/>

            <!-- Individual address -->
            <h:outputLabel
                    value="#{msg['dialog.notificationDialog.mail.individualAddress.text']}"
                    title="#{msg['dialog.notificationDialog.mail.individualAddress.info']}"
                    styleClass="bigFont"/>
            <p:selectBooleanCheckbox
                    disabled="#{!notificationDialog.mailTab.useNotification}"
                    value="#{notificationDialog.mailTab.individualAddresses}"
                    title="#{msg['dialog.notificationDialog.mail.individualAddress.info']}">
                <p:ajax event="change" process="@this" update="@form"/>
            </p:selectBooleanCheckbox>

            <!-- pdf template -->
            <h:outputLabel
                    value="#{msg['dialog.notificationDialog.mail.template.text']}"
                    title="#{msg['dialog.notificationDialog.mail.template.info']}"
                    styleClass="bigFont"/>
            <p:selectOneMenu
                    value="#{notificationDialog.mailTab.selectedTemplate}"
                    title="#{msg['dialog.notificationDialog.mail.template.info']}"
                    converter="#{notificationDialog.mailTab.templatesTransformer}"
                    disabled="#{!notificationDialog.mailTab.useNotification}">

                <f:selectItem itemValue="#{null}"
                              itemLabel="#{msg['dialog.notificationDialog.mail.template.none']}"/>

                <f:selectItems
                        value="#{notificationDialog.mailTab.templates}"
                        var="template" itemLabel="#{template.name}" itemValue="#{template}"/>

                <p:ajax update="@this" event="change" process="@this"/>
            </p:selectOneMenu>

            <!-- receiver -->
            <h:outputLabel
                    value="#{msg['dialog.notificationDialog.mail.receiverTable.text']}"
                    styleClass="bigFont"/>

            <p:dataTable var="reportIntentNotificationBearer" scrollable="true" scrollHeight="160"
                         style="width:96%" id="notificationTable" styleClass="defaultHistoDataTable"
                         value="#{notificationDialog.mailTab.reportIntentStatus.reportNotificationIntents}"
                         sortBy="#{reportIntentNotificationBearer.status}">

                <!-- header sorting by status -->
                <p:headerRow>
                    <p:column colspan="5">
                        <h:outputText
                                value="#{msg['dialog.notificationDialog.notificationStatus.'.concat(reportIntentNotificationBearer.status)]}"/>
                    </p:column>
                </p:headerRow>

                <!-- perform notification on user -->
                <p:column style="width:7%;text-align:center;">
                    <f:facet name="header">
                        <i class="fa fa-check-circle-o "
                           title="#{msg['dialog.notificationDialog.mail.receiverTable.perform']}"/>
                    </f:facet>

                    <p:selectBooleanCheckbox
                            disabled="#{!notificationDialog.mailTab.useNotification or !reportIntentNotificationBearer.renderInactiveButton}"
                            title="#{msg['dialog.notificationDialog.mail.receiverTable.perform']}"
                            value="#{reportIntentNotificationBearer.performNotification}">
                        <p:ajax event="change" update="@form"/>
                    </p:selectBooleanCheckbox>
                </p:column>

                <!-- name of receiver -->
                <p:column
                        headerText="#{msg['dialog.notificationDialog.mail.receiverTable.name']}"
                        style="width:auto">
                    <h:outputText value="#{reportIntentNotificationBearer.reportIntent.person.getFullName()}"/>
                </p:column>

                <!-- email -->
                <p:column
                        headerText="#{msg['dialog.notificationDialog.mail.receiverTable.mail']}"
                        style="width:auto">
                    <p:inputText value="#{reportIntentNotificationBearer.contactAddress}"
                                 disabled="#{!notificationDialog.mailTab.useNotification or !reportIntentNotificationBearer.performNotification}"
                                 style="width:96%"/>
                </p:column>

                <!-- options -->
                <p:column style="width:10%;" styleClass="centerChildElements centerHeaderChildElements">
                    <f:facet name="header">
                        <i class="fa fa-file-pdf-o"
                           title="#{msg['dialog.notificationDialog.mail.receiverTable.pdf.info']}"/>
                    </f:facet>

                    <!-- add pdf, if pdf == null -->
                    <p:commandLink
                            rendered="#{reportIntentNotificationBearer.pdf eq null and reportIntentNotificationBearer.performNotification}"
                            disabled="#{!notificationDialog.mailTab.useNotification}"
                            title="#{msg['dialog.notificationDialog.mail.receiverTable.pdf.select']}"
                            execute="@this"
                            actionListener="#{notificationDialog.openSelectPDFDialog(notificationDialog.task, reportIntentNotificationBearer.reportIntent)}">

                        <!-- current container is passed to the dialogReturn methode -->
                        <f:attribute name="container" value="#{reportIntentNotificationBearer}"/>

                        <p:ajax event="dialogReturn" update="@form" process="@form"
                                listener="#{notificationDialog.onSubDialogReturn}">
                        </p:ajax>

                        <i class="fa fa-fw fa-file-pdf-o"/>
                    </p:commandLink>

                    <!-- show pdf, if pdf != null -->
                    <p:commandLink
                            rendered="#{reportIntentNotificationBearer.pdf ne null and reportIntentNotificationBearer.performNotification}"
                            title="#{msg['dialog.notificationDialog.mail.receiverTable.pdf.view']}"
                            execute="@this"
                            disabled="#{!notificationDialog.mailTab.useNotification}"
                            actionListener="#{dialog.pdfOrganizer.initAndPrepareBean(notificationDialog.task.patient).viewMode().setPDFToDisplay(reportIntentNotificationBearer.pdf)}">

                        <i class="fa fa-search icon-grey"/>
                    </p:commandLink>

                    <!-- remove pdf, if pdf != null -->
                    <p:commandLink style="margin-left: 10px;"
                                   rendered="#{reportIntentNotificationBearer.pdf ne null and reportIntentNotificationBearer.performNotification}"
                                   title="#{msg['dialog.notificationDialog.mail.receiverTable.pdf.remove']}"
                                   execute="@this"
                                   disabled="#{!notificationDialog.mailTab.useNotification}"
                                   update="@form" actionListener="#{reportIntentNotificationBearer.setPdf(null)}">

                        <i class="fa fa-close icon-grey"/>
                    </p:commandLink>


                </p:column>

                <!-- enable and disable -->
                <p:column style="width: 5%" styleClass="centerChildElements centerHeaderChildElements">
                    <f:facet name="header">
                        <i class="fa fa-stop"
                           title="#{msg['dialog.notificationDialog.mail.receiverTable.active.headline']}"/>
                    </f:facet>
                    <!-- enable button -->
                    <p:commandLink
                            rendered="#{reportIntentNotificationBearer.renderActiveButton}"
                            title="#{msg['dialog.notificationDialog.mail.receiverTable.active.enable']}"
                            execute="@this"
                            disabled="#{!notificationDialog.mailTab.useNotification}"
                            update="@form"
                            actionListener="#{notificationDialog.disableNotification(reportIntentNotificationBearer.reportIntentNotification, true)}">
                        <i class="fa fa-undo icon-grey"/>
                    </p:commandLink>

                    <!-- disable button -->
                    <p:commandLink
                            rendered="#{reportIntentNotificationBearer.renderInactiveButton}"
                            title="#{msg['dialog.notificationDialog.mail.receiverTable.active.disable']}"
                            execute="@this"
                            disabled="#{!notificationDialog.mailTab.useNotification}"
                            update="@form"
                            actionListener="#{notificationDialog.disableNotification(reportIntentNotificationBearer.reportIntentNotification, false)}">
                        <i class="fa fa-times-circle icon-red"/>
                    </p:commandLink>
                </p:column>
            </p:dataTable>
        </h:panelGrid>
    </p:outputPanel>

    <div class="buttonContainer">
        <h:panelGrid columns="2">
            <h:panelGrid columns="1" styleClass="left">
                <!-- Contact -->
                <p:commandButton process="@form"
                                 value="#{msg['dialog.notificationDialog.button.select.text']}"
                                 icon="fa fa-fw fa-cog"
                                 title="#{msf['dialog.notificationDialog.button.select.info']}"
                                 actionListener="#{contactDialog.initAndPrepareBean(notificationDialog.task)}">
                    <p:ajax event="dialogReturn" update="@form"
                            listener="#{notificationDialog.update}"/>
                </p:commandButton>
            </h:panelGrid>

            <h:panelGrid columns="3" styleClass="right" id="buttonContainer">
                <!-- previouse -->
                <p:commandButton value="#{msg['general.back']}"
                                 icon="fa fa-fw fa-arrow-left"
                                 actionListener="#{notificationDialog.previousTab()}"
                                 process="@form" update="@form"/>

                <!-- next -->
                <p:commandButton value="#{msg['general.next']}"
                                 icon="fa fa-fw fa-arrow-right"
                                 actionListener="#{notificationDialog.nextTab()}"
                                 process="@form" update="@form"/>

                <!-- close -->
                <p:commandButton value="#{msg['general.close']}"
                                 icon="fa fa-times-circle" process="@form"
                                 actionListener="#{notificationDialog.hideDialog()}"/>
            </h:panelGrid>
        </h:panelGrid>
    </div>
</ui:composition>
