<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<h:head>
	<title><h:outputFormat
			value="#{msg['dialog.createTask.headline']}" /></title>
	<h:outputStylesheet name="style.css" value="style.css" library="css" />
	<h:outputStylesheet name="specificStyle.css" value="specificStyle.css"
		library="css" />
	<h:outputScript library="scripts" name="commonFunctions.js" />
</h:head>

<h:body styleClass="histoDialogStyle">

	<h:form enctype="multipart/form-data" id="dialogContent">

		<div class="dialogHeader">
			<h:panelGrid style="width:100%;" columns="2"
				styleClass="defaultHistoTable">
				<h:outputLabel value="#{msg['dialog.createTask.headline']}" />
				<p:commandLink title="#{msg['general.close']}" style="float:right;"
					onclick="$('#dialogContent\\:closeBtn').click();return false;">
					<i class="fa fa-fw fa-times" />
				</p:commandLink>
			</h:panelGrid>
		</div>

		<div class="dialogContent">
			<h:panelGrid columns="2" style="width:100%"
				columnClasses="columnWidthPercent50 columnTop, columnWidthPercent50 columnTop"
				styleClass="defaultHistoHiddenTableContainer">

				<h:panelGrid columns="2" styleClass="defaultHistoTable"
					columnClasses="columnWidth150 columnHeading,">

					<!-- Task number -->
					<h:outputLabel value="#{msg['dialog.createTask.taskNumber']}"></h:outputLabel>
					<h:panelGrid columns="2"
						styleClass="listingHistoHiddenTableContainer" id="taskIdContainer">
						<p:inputText required="true" maxlength="6" id="taskIDInput"
							validator="#{dialog.createTaskDialog.validateTaskID}"
							value="#{dialog.createTaskDialog.taskData.taskID}">
							<p:ajax delay="500" event="keyup" update="taskIdContainer"></p:ajax>
						</p:inputText>
						<p:message for="taskIDInput" display="icon"
							style="margin-left:10px" />
					</h:panelGrid>

					<!-- Task Date -->
					<h:outputLabel value="#{msg['dialog.createTask.taskEDate']}"></h:outputLabel>
					<p:calendar pattern="dd.MM.yyyy" mask="true" id="dueDate"
						value="#{dialog.createTaskDialog.taskData.dateOfReceipt}">
					</p:calendar>

					<!-- Auto nomenclature -->
					<h:outputLabel value="#{msg['dialog.createTask.autoNomenclature']}" />
					<p:selectBooleanCheckbox id="autoNomenclature"
						title="#{msg['dialog.createTask.autoNomenclature.text']}"
						value="#{dialog.createTaskDialog.taskData.useAutoNomenclature}">
						<p:ajax update="sampleTable"
							listener="#{dialog.createTaskDialog.taskData.updateSampleNames()}"></p:ajax>
					</p:selectBooleanCheckbox>


					<!-- priority -->
					<h:outputLabel value="#{msg['dialog.createTask.priority']}" />
					<p:selectOneRadio
						value="#{dialog.createTaskDialog.taskData.taskPriority}">
						<f:selectItem itemLabel="#{msg['enum.taskPriority.LOW']}"
							itemValue="NONE" />
						<f:selectItem itemLabel="#{msg['enum.taskPriority.HIGHT']}"
							itemValue="HIGH" />
						<f:selectItem itemLabel="#{msg['enum.taskPriority.TIME']}"
							itemValue="TIME" />

						<p:ajax update="@form" process="@form"></p:ajax>
					</p:selectOneRadio>

					<h:outputLabel value="" />
					<h:panelGrid columns="2"
						styleClass="listingHistoHiddenTableContainer">
						<!-- due date -->
						<h:outputLabel
							value="#{msg['dialog.createTask.priority.dueDate']}" />
						<p:calendar pattern="dd.MM.yyyy" mask="true"
							style="margin-left:10px"
							disabled="#{dialog.createTaskDialog.taskData.taskPriority ne 'TIME'}"
							value="#{dialog.createTaskDialog.taskData.dueDate}">
						</p:calendar>
					</h:panelGrid>
				</h:panelGrid>


				<!-- bio bank -->
				<h:panelGrid columns="2" styleClass="defaultHistoTable"
					columnClasses="columnWidth150 columnHeading,">

					<!-- bio bank -->
					<h:outputLabel value="#{msg['dialog.createTask.bioBank']}" />
					<h:panelGrid columns="2"
						styleClass="listingHistoHiddenTableContainer">
						<!-- select file -->
						<h:outputLabel
							value="#{msg['dialog.createTask.bioBank.informedConsent.signed']}" />
						<p:commandLink style="margin-left:5px;"
							actionListener="#{dialog.pdfOrganizer.initAndPrepareBean(dialog.createTaskDialog.patient).selectMode()}">
							<p:ajax event="dialogReturn" update="@form" process="@form"
								listener="#{dialog.createTaskDialog.taskData.bioBank.onMediaSelectReturn}" />
							<i class="fa fa-search icon-grey"></i>
						</p:commandLink>
					</h:panelGrid>

					<!-- selected file /remove file -->
					<h:outputLabel
						value="#{msg['dialog.createTask.bioBank.informedConsent.file']}:" />

					<h:panelGrid columns="2"
						styleClass="listingHistoHiddenTableContainer">
						<p:commandLink
							rendered="#{dialog.createTaskDialog.taskData.bioBank.isPDFSelected()}"
							actionListener="#{dialog.pdfOrganizer.initAndPrepareBean(dialog.createTaskDialog.patient).selectMode().setPDFToDisplay(dialog.createTaskDialog.taskData.bioBank.container)}">
							<p:ajax event="dialogReturn" update="@form" process="@form"
								listener="#{dialog.createTaskDialog.taskData.bioBank.onMediaSelectReturn}" />
							<h:outputLabel
								value="#{dialog.createTaskDialog.taskData.bioBank.container.name}">
								<f:converter converterId="org.histo.ui.TruncateConverter" />
								<f:attribute name="truncateAt" value="35" />
								<f:attribute name="continuationMark" value="..." />
							</h:outputLabel>
						</p:commandLink>

						<!-- remove -->
						<p:commandLink style="margin-left:5px;" update="@form"
							process="@form"
							rendered="#{dialog.createTaskDialog.taskData.bioBank.isPDFSelected()}"
							actionListener="#{dialog.createTaskDialog.taskData.bioBank.setContainer(null)}">
							<i class="fa fa-remove icon-grey"></i>
						</p:commandLink>
					</h:panelGrid>

					<!-- type of informed consent -->
					<h:outputLabel
						value="#{msg['dialog.createTask.bioBank.informedConsent.type']}" />
					<p:selectOneMenu id="consentType" styleClass="smallInput"
						value="#{dialog.createTaskDialog.taskData.bioBank.informedConsentType}"
						disabled="#{!dialog.createTaskDialog.taskData.bioBank.isPDFSelected()}">
						<f:selectItems value="#{enumProvider.informedConsentTypes}"
							var="type"
							itemLabel="#{msg['enum.informedConsentType.'.concat(type)]}"
							itemValue="#{type}" />
					</p:selectOneMenu>

				</h:panelGrid>
			</h:panelGrid>

			<!-- seperator -->
			<h:panelGrid columns="1" styleClass="defaultHistoSeperatorTable">
				<p:separator />
			</h:panelGrid>

			<h:panelGrid columns="2" style="width:100%"
				columnClasses="columnWidthPercent50 columnTop, columnWidthPercent50 columnTop"
				styleClass="defaultHistoHiddenTableContainer">


				<!-- Left column -->
				<h:panelGrid columns="2" styleClass="defaultHistoTable"
					columnClasses="columnWidth150 columnHeading,">

					<!-- external material -->
					<h:outputLabel value="#{msg['dialog.createTask.external']}"></h:outputLabel>
					<p:selectBooleanCheckbox
						title="#{msg['dialog.createTask.external.text']}"
						value="#{dialog.createTaskDialog.taskData.externalSamples}">
						<p:ajax event="change" process="@form" update="@form" />
					</p:selectBooleanCheckbox>

					<!-- external commentary  -->
					<h:outputLabel value="#{msg['dialog.createTask.external.return']}"></h:outputLabel>
					<p:inputTextarea rows="4" cols="35"
						value="#{dialog.createTaskDialog.taskData.exnternalSampleCommentary}"
						disabled="#{!dialog.createTaskDialog.taskData.externalSamples}"></p:inputTextarea>

				</h:panelGrid>

				<!-- right column -->
				<h:panelGrid columns="2" styleClass="defaultHistoTable"
					id="sampleTable" columnClasses="columnWidth150 columnHeading">
					<!-- samples -->

					<h:outputLabel value="#{msg['dialog.createTask.sampels']}" />
					<h:panelGroup layout="block" style="width:41%">
						<!-- remove -->
						<p:commandLink update="sampleTable"
							style="float:right;margin-left:5px;"
							actionListener="#{dialog.createTaskDialog.taskData.removeSample()}">
							<i class="fa fa-minus-square icon-grey"
								title="#{msg['dialog.createTask.sampels.add']}" />
						</p:commandLink>
						
						<!-- add -->
						<p:commandLink update="sampleTable" style="float:right;"
							actionListener="#{dialog.createTaskDialog.taskData.addSample()}">
							<i class="fa fa-plus-square icon-grey"
								title="#{msg['dialog.createTask.sampels.remove']}" />
						</p:commandLink>
					</h:panelGroup>

					<c:forEach var="sample" varStatus="sampleIndex"
						items="#{dialog.createTaskDialog.taskData.samples}">

						<h:outputFormat value="#{msg['dialog.createTask.sample']}">
							<f:param value="#{sample.sampleID}" />
						</h:outputFormat>

						<h:panelGroup>
							<!-- material text -->
							<p:inputText value="#{sample.material}"
								onkeypress="PF('materialOverlayPanel#{sampleIndex.index}').hide();"
								onclick="PF('materialOverlayPanel#{sampleIndex.index}').show();"
								onfocus="PF('materialOverlayPanel#{sampleIndex.index}').show();"
								id="materialName#{sampleIndex.index}" style="width:40%">
							</p:inputText>

							<!-- select material -->
							<p:overlayPanel
								widgetVar="materialOverlayPanel#{sampleIndex.index}"
								id="materialOverlayPanel#{sampleIndex.index}"
								styleClass="histoOverlayPanel"
								for="materialName#{sampleIndex.index}" hideEffect="fade"
								hideEvent="none" showEvent="none">
								<p:dataTable value="#{dialog.createTaskDialog.materialList}"
									var="item" styleClass="defaultHistoDataTable" scrollable="true"
									scrollHeight="200" rowKey="#{item.id}"
									selection="#{sample.materialPreset}" selectionMode="single">
									<p:column>
										<h:outputText value="#{item.name}" />
									</p:column>

									<p:ajax event="rowSelect" update="@form"
										listener="#{sample.onMaterialPresetChange()}"
										oncomplete="PF('materialOverlayPanel#{sampleIndex.index}').hide();" />
								</p:dataTable>
							</p:overlayPanel>
						</h:panelGroup>
					</c:forEach>
				</h:panelGrid>
			</h:panelGrid>
		</div>

		<div class="buttonContainer">
			<h:panelGrid columns="2">

				<h:panelGrid columns="3" styleClass="left">

					<!-- confirm -->
					<p:commandButton value="#{msg['general.create']}" update="@form"
						widgetVar="confirmBtn" process="@form" icon="fa fa-check-circle-o">
						<f:actionListener
							binding="#{dialog.createTaskDialog.createAndHide()}"></f:actionListener>
					</p:commandButton>

					<!-- print ureport -->
					<p:commandButton
						value="#{msg['dialog.createTask.button.print.UReport']}"
						style="margin-left:20px !important;"
						widgetVar="confirmAndPrintBtn" update="@form" process="@form"
						icon="fa fa-print">
						<f:actionListener
							binding="#{dialog.createTaskDialog.createPrintAndHide()}"></f:actionListener>
					</p:commandButton>

					<!-- select printer -->
					<p:selectOneMenu 
						title="#{msg['dialog.print.selectPrinter']}"
						panelStyleClass="searchSelectMenuPanel"
						converter="#{printService.cupsPrinter.printerTransformer}"
						value="#{userHandlerAction.selectedPrinter}" filter="true"
						filterMatchMode="contains">

						<f:selectItems value="#{printService.cupsPrinter.printer}"
							var="printer" itemLabel="#{printer.name}" itemValue="#{printer}" />

						<p:ajax event="change" process="@this"></p:ajax>
					</p:selectOneMenu>
				</h:panelGrid>

				<h:panelGrid columns="1" styleClass="right">
					<!-- Abort button -->
					<p:commandButton value="#{msg['general.abort']}" id="closeBtn"
						widgetVar="abortBtn" immediate="true" icon="fa fa-times-circle">
						<f:actionListener
							binding="#{dialog.createTaskDialog.hideDialog()}"></f:actionListener>
					</p:commandButton>
				</h:panelGrid>
			</h:panelGrid>
		</div>

		<ui:include src="../../../template/blockUi.xhtml"></ui:include>
	</h:form>
</h:body>
</html>