<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:histo="http://java.sun.com/jsf/composite/components">

<h:head>
    <title><h:outputFormat
            value="#{msg['dialog.council.headline']}"/></title>
    <h:outputStylesheet name="style.css" value="style.css" library="css"/>
    <h:outputStylesheet name="specificStyle.css" value="specificStyle.css"
                        library="css"/>
    <h:outputScript library="scripts" name="commonFunctions.js"/>
    <h:outputScript library="scripts" name="updateAndScrollScrollPanel.js"></h:outputScript>
</h:head>

<h:body styleClass="histoTabDialogStyle councilDialog">
    <h:form id="dialogContent">

        <div class="dialogHeader">
            <h:panelGrid style="width:100%;" columns="2"
                         styleClass="defaultHistoTable">
                <h:outputLabel value="#{msg['dialog.council.headline']}"/>
                <p:commandLink title="#{msg['general.close']}" style="float:right;"
                               immediate="true"
                               actionListener="#{dialog.councilDialog.hideDialog()}">
                    <i class="fa fa-fw fa-times"/>
                </p:commandLink>
            </h:panelGrid>
        </div>

        <h:panelGrid columns="2" styleClass="dialogContainer"
                     columnClasses="navColumn300">
            <p:outputPanel id="navigationTable" styleClass="navigationTable">
                <p:panelGrid styleClass="defaultHistoHiddenTableContainer"
                             style="background: black; height: 655px;width:100%">
                    <p:row>
                        <p:column styleClass="columnTop" style="height:505px">
                            <!-- scrolling -->
                            <p:scrollPanel styleClass="histoScrollPanelStyle" id="scrollBody"
                                           style="height:500px;width:285px !important">
                                <!-- navigation tree -->
                                <p:tree value="#{dialog.councilDialog.root}" var="node"
                                        dynamic="true" styleClass="histoTree" style="width:99%"
                                        id="menuTree" selectionMode="single"
                                        selection="#{dialog.councilDialog.selectedNode}">

                                    <p:ajax event="select" partialSubmit="true" process="@this"
                                            update="dialogContent:dialogContent dialogContent:councilInfo"/>

                                    <!-- root -->
                                    <p:treeNode expandedIcon="ui-icon-folder-open"
                                                collapsedIcon="ui-icon-folder-collapsed">
                                        <h:outputText value="#{node}"/>
                                    </p:treeNode>

                                    <!-- Task -->
                                    <p:treeNode type="task" expandedIcon="ui-icon-folder-open"
                                                collapsedIcon="ui-icon-folder-collapsed">
                                        <h:outputText value="#{node.taskID}"/>
                                    </p:treeNode>

                                    <!-- coucil -->
                                    <p:treeNode type="council" expandedIcon="fa fa-comment-o"
                                                collapsedIcon="fa fa-comment-o">
                                        <h:outputText value="#{node.name}" title="#{node.name}">
                                            <f:converter converterId="org.histo.ui.TruncateConverter"/>
                                            <f:attribute name="truncateAt" value="35"/>
                                            <f:attribute name="continuationMark" value="..."/>
                                        </h:outputText>
                                    </p:treeNode>

                                    <!-- council request -->
                                    <p:treeNode type="council_request" icon="fa fa-edit">
                                        <h:outputText value="#{msg['dialog.council.tree.request']}"/>

                                        <!-- completed -->
                                        <ui:fragment rendered="#{node.councilRequestCompleted}">
                                            <i class="fa fa-check-circle icon-green"
                                               title="#{msg['dialog.council.tree.request.completed.info']}"/>
                                        </ui:fragment>
                                    </p:treeNode>

                                    <!-- council request -->
                                    <p:treeNode type="council_ship" icon="fa fa-envelope">
                                        <h:outputText value="#{msg['dialog.council.tree.ship']}"/>

                                        <!-- waiting for shipment -->
                                        <ui:fragment
                                                rendered="#{node.councilRequestCompleted and node.isShippentExpected() and !node.sampleShipped}">
                                            <i class="fa fa-exclamation-circle icon-red"
                                               title="#{msg['dialog.council.tree.ship.expected.info']}"/>
                                        </ui:fragment>

                                        <!-- shipment completed -->
                                        <ui:fragment rendered="#{node.sampleShipped}">
                                            <i class="fa fa-check-circle icon-green"
                                               title="#{msg['dialog.council.tree.ship.completed.info']}"/>
                                        </ui:fragment>

                                        <!-- waiting for return -->
                                        <ui:fragment
                                                rendered="#{node.expectSampleReturn and !node.sampleReturned}">
                                            <i class="fa fa-undo icon-red"
                                               title="#{msg['dialog.council.tree.return.expected.info']}"/>
                                        </ui:fragment>

                                        <!-- shipment and return completed  -->
                                        <ui:fragment
                                                rendered="#{node.expectSampleReturn and node.sampleReturned}">
                                            <i class="fa fa-check-circle icon-green"
                                               title="#{msg['dialog.council.tree.return.completed.info']}"/>
                                        </ui:fragment>
                                    </p:treeNode>

                                    <!-- reply-->
                                    <p:treeNode type="council_reply" icon="fa fa-user-md">
                                        <h:outputText value="#{msg['dialog.council.tree.reply']}"/>

                                        <!-- reply pending -->
                                        <ui:fragment
                                                rendered="#{node.councilRequestCompleted and !node.replyReceived}">
                                            <i class="fa fa-exclamation-circle icon-red"
                                               title="#{msg['dialog.council.tree.reply.pending.info']}"/>
                                        </ui:fragment>

                                        <!-- reply received -->
                                        <ui:fragment rendered="#{node.replyReceived}">
                                            <i class="fa fa-check-circle icon-green"
                                               title="#{msg['dialog.council.tree.reply.completed.info']}"/>
                                        </ui:fragment>
                                    </p:treeNode>

                                    <!-- finalize node-->
                                    <p:treeNode type="council_diagnosis" icon="fa fa-edit">
                                        <h:outputText value="#{msg['dialog.council.tree.finalize']}"/>

                                        <!-- not finalized -->
                                        <ui:fragment
                                                rendered="#{node.councilRequestCompleted and node.replyReceived and !node.listStatus.inListCouncilCompleted}">
                                            <i class="fa fa-exclamation-circle icon-red"
                                               title="#{msg['dialog.council.tree.finalize.pending.info']}"/>
                                        </ui:fragment>

                                        <!-- finalized -->
                                        <ui:fragment rendered="#{node.listStatus.inListCouncilCompleted}">
                                            <i class="fa fa-check-circle icon-green"
                                               title="#{msg['dialog.council.tree.finalize.completed.info']}"/>
                                        </ui:fragment>
                                    </p:treeNode>

                                    <!-- data node-->
                                    <p:treeNode type="data_node" expandedIcon="ui-icon-folder-open"
                                                collapsedIcon="ui-icon-folder-collapsed">
                                        <h:outputText value="#{msg['dialog.council.tree.files']}"/>
                                    </p:treeNode>

                                    <!-- pdf -->
                                    <p:treeNode type="pdf_node" icon="fa fa-file-pdf-o">
                                        <h:panelGrid columns="2" styleClass="mouseEntryEventElemnt"
                                                     id="bine">
                                            <f:passThroughAttribute name="tvalue"
                                                                    value="#{node.container.id}"/>
                                            <!-- name -->
                                            <h:outputText value="#{node.container.name}" id="treeNode">
                                                <f:converter converterId="org.histo.ui.TruncateConverter"/>
                                                <f:attribute name="truncateAt" value="20"/>
                                                <f:attribute name="continuationMark" value="..."/>
                                            </h:outputText>

                                            <!-- download -->
                                            <p:commandLink
                                                    action="#{dialog.councilDialog.stream.openPDFinNewWindow()}"
                                                    ajax="false" title="#{msg['dialog.print.button.open.text']}"
                                                    oncomplete="return false;" target="_blank">
                                                <i class="fa fa-eye" title=""/>
                                            </p:commandLink>

                                        </h:panelGrid>

                                        <!-- tooltip -->
                                        <pe:tooltip for="bine" onShow="updatef1#{node.container.id}()"
                                                    mouseTracking="true" myPosition="top left" adjustX="10"
                                                    adjustY="10">

                                            <p:remoteCommand name="updatef1#{node.container.id}"
                                                             update="bild2"/>

                                            <h:panelGrid columns="2"
                                                         columnClasses="columnTop, columnLeft" id="bild2"
                                                         style="width:100%"
                                                         styleClass="defaultHistoHiddenTableContainer">
                                                <h:panelGrid columns="2" styleClass="defaultHistoTable">
                                                    <!-- name -->
                                                    <h:outputText
                                                            value="#{msg['component.pdfAuditInfo.name']}"/>
                                                    <h:outputText value="#{node.container.name}">
                                                        <f:converter converterId="org.histo.ui.TruncateConverter"/>
                                                        <f:attribute name="truncateAt" value="35"/>
                                                        <f:attribute name="continuationMark" value="..."/>
                                                    </h:outputText>

                                                    <!-- created date-->
                                                    <h:outputText
                                                            value="#{msg['component.pdfAuditInfo.createdOn']}"></h:outputText>
                                                    <h:outputText value="#{node.container.audit.createdOn}">
                                                        <f:convertDateTime type="date"
                                                                           pattern="dd.MM.yyyy HH:mm:ss"/>
                                                    </h:outputText>

                                                    <!-- created name-->
                                                    <h:outputText
                                                            value="#{msg['component.pdfAuditInfo.createdBy']}"></h:outputText>
                                                    <h:outputText value="#{node.container.audit.createdBy}">
                                                    </h:outputText>

                                                    <!-- updated date-->
                                                    <h:outputText
                                                            value="#{msg['component.pdfAuditInfo.updatedOn']}"></h:outputText>
                                                    <h:outputText
                                                            style="#{node.container.audit.updatedOn eq 0 ? 'display:none' : ''}"
                                                            value="#{node.container.audit.updatedOn}">
                                                        <f:convertDateTime type="date"
                                                                           pattern="dd.MM.yyyy HH:mm:ss"/>
                                                    </h:outputText>

                                                    <!-- updated name-->
                                                    <h:outputText
                                                            value="#{msg['component.pdfAuditInfo.updatedBy']}"></h:outputText>
                                                    <h:outputText value="#{node.container.audit.updatedBy}">
                                                    </h:outputText>

                                                    <!-- type -->
                                                    <h:outputText
                                                            value="#{msg['component.pdfAuditInfo.type']}"></h:outputText>
                                                    <h:outputLabel
                                                            value="#{msg['enum.documentType.'.concat(node.container.type)]}"/>

                                                    <!-- commentary -->
                                                    <h:outputText
                                                            value="#{msg['component.pdfAuditInfo.commentary']}"></h:outputText>
                                                    <h:outputText value="#{node.container.commentary}"
                                                                  title="#{node.container.commentary}">
                                                        <f:converter converterId="org.histo.ui.TruncateConverter"/>
                                                        <f:attribute name="truncateAt" value="35"/>
                                                        <f:attribute name="continuationMark" value="..."/>
                                                    </h:outputText>
                                                </h:panelGrid>

                                                <!-- preview image -->
                                                <h:panelGrid columns="1" styleClass="defaultHistoTable">
                                                    <p:graphicImage
                                                            value="#{dialog.councilDialog.stream.getThumbnailStream()}"
                                                            style="border: 1px solid black; float: right;"
                                                            width="200px" cache="false" alt="unable to load image"/>
                                                </h:panelGrid>
                                            </h:panelGrid>
                                        </pe:tooltip>

                                        <p:remoteCommand name="updateToolTip#{node.container.id}"
                                                         actionListener="#{dialog.councilDialog.stream.renderThumbnail(node.container)}"/>
                                    </p:treeNode>
                                </p:tree>
                            </p:scrollPanel>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="columnTop">
                            <!-- audit table -->
                            <histo:auditTable id="councilInfo"
                                              rendered="#{dialog.councilDialog.selectedCouncil ne null}"
                                              auditElement="#{dialog.councilDialog.selectedCouncil.audit}"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>


                <div class="buttonContainer">
                    <h:panelGrid columns="2" style="width:100%"
                                 styleClass="newTableContainer">

                        <h:panelGrid columns="1" styleClass="newTableContainer left">
                            <p:commandButton value="#{msg['dialog.council.button.create']}"
                                             icon="fa fa-check-circle-o" update="@form"
                                             disabled="#{!dialog.councilDialog.editable}"
                                             actionListener="#{dialog.councilDialog.createCouncil()}"></p:commandButton>
                        </h:panelGrid>

                        <h:panelGrid columns="1" styleClass="newTableContainer right">
                        </h:panelGrid>
                    </h:panelGrid>
                </div>
            </p:outputPanel>
            <p:outputPanel id="dialogContent" styleClass="dialogContent">
                <ui:include src="#{dialog.councilDialog.getCenterInclude()}"></ui:include>
            </p:outputPanel>
        </h:panelGrid>

        <ui:include src="../../../template/blockUi.xhtml"></ui:include>

        <script>
            $(document).ready(function () {
                setMouseEnterEvents(true);
                commonFunctions.initializeCustomScrollPanel("dialogContent:scrollBody");
            });

            // mouse entry event for tree nodes
            function setMouseEnterEvents() {
                $(".mouseEntryEventElemnt").each(function (index) {

                    $(this).mouseenter(function () {
                        eval("updateToolTip" + $(this).attr("tvalue") + "()");
                        //PF('tooltipOverlay').show($(this).attr("id"));
                    });

                    $(this).mouseleave(function () {
                        //PF('tooltipOverlay').hide();
                    });

                });
            }
        </script>
    </h:form>
</h:body>
</html>
        <!-- showMediaSelectDialog -->