<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
>

<!-- importing enum for switch -->
<p:importEnum
        type="com.patho.main.model.patient.notification.NotificationTyp"
        var="notificationTyp" allSuffix="ALL_ENUM_VALUES"/>

<h:head>
    <title><h:outputFormat
            value="#{msg['dialog.contactDialog.headline']}"/></title>
    <h:outputStylesheet name="style.css" value="style.css" library="css"/>
    <h:outputStylesheet name="specificStyle.css" value="specificStyle.css"
                        library="css"/>
    <h:outputScript library="scripts" name="commonFunctions.js"/>
</h:head>

<h:body styleClass="histoDialogStyle">
    <h:form id="dialogContent">

        <div class="dialogHeader">
            <h:panelGrid style="width:100%;" columns="2">
                <h:outputLabel value="#{msg['dialog.contactDialog.headline']}"/>
                <p:commandLink title="#{msg['general.close']}" style="float:right;"
                               onclick="$('#dialogContent\\:closeBtn').click();return false;">
                    <i class="fa fa-fw fa-times"/>
                </p:commandLink>
            </h:panelGrid>
        </div>

        <div class="dialogContent">

            <h:panelGrid columns="1" styleClass="defaultHistoTable">

                <!-- contacts -->
                <p:dataTable var="contactHolder" styleClass="contactDialog_DataTable"
                             id="contactDatas" scrollable="true" scrollHeight="480"
                             sortBy="#{contactHolder.item.id}"
                             value="#{contactDialog.reportIntents}">

                    <!-- Name -->
                    <p:column headerText="#{msg['dialog.contactDialog.data.name']}"
                              style="width: auto !important"
                              filterBy="#{contactHolder.item.person.lastName}"
                              filterMatchMode="contains">
                        <h:outputText
                                value="#{contactHolder.item.person.getFullName()}  #{contactHolder.id} s"/>
                    </p:column>

                    <p:column headerText="#{msg['dialog.contactDialog.data.role']}"
                              style="width:15% !important">
                        <h:outputText
                                value="#{msg['enum.contactRole.'.concat(contactHolder.item.role)]}"/>
                    </p:column>

                    <!-- status by type -->
                    <p:column headerText="#{msg['dialog.contactDialog.data.notification']}">
                        <p:repeat value="#{contactHolder.reportIntentByTyp}" var="intentByType" varStatus="index">
                            <h:panelGrid styleClass="listingHistoHiddenTableContainer" columns="3" style="width:auto">
                                <pe:switch value="#{intentByType.reportIntentNotification.notificationTyp}">
                                    <!-- mail -->
                                    <pe:case value="#{notificationTyp.EMAIL}">
                                        <i class="fa fa-envelope icon-grey"/>
                                    </pe:case>
                                    <!-- fax -->
                                    <pe:case value="#{notificationTyp.FAX}">
                                        <i class="fa fa-fax icon-grey"/>
                                    </pe:case>
                                    <!-- letter -->
                                    <pe:case value="#{notificationTyp.LETTER}">
                                        <i class="fa fa-pencil-square-o icon-grey"/>
                                    </pe:case>
                                    <!-- phone -->
                                    <pe:case value="#{notificationTyp.PHONE}">
                                        <i class="fa fa-phone icon-grey"/>
                                    </pe:case>
                                    <!-- print -->
                                    <pe:case value="#{notificationTyp.PRINT}">
                                        <i class="fa fa-print icon-grey"/>
                                    </pe:case>
                                    <!-- default -->
                                    <pe:defaultCase>
                                        <i class="fa fa-question icon-grey"/>
                                    </pe:defaultCase>
                                </pe:switch>

                                <!-- name -->
                                <h:outputText
                                        style="margin-left: 5px"
                                        value="#{msg['enum.notificationType.'.concat(intentByType.reportIntentNotification.notificationTyp)]}"/>

                                <!-- status, only visible if a report notification was performed -->
                                <ui:fragment rendered="#{intentByType.history}">
                                    <i class="fa fa-fw #{intentByType.reportStatus ? 'fa-check-circle icon-green' :'fa-exclamation-triangle icon-red'}"/>
                                </ui:fragment>
                            </h:panelGrid>
                        </p:repeat>
                    </p:column>

                    <!-- options -->
                    <p:column headerText="#{msg['dialog.contactDialog.data.options']}" style="width:50px !important">
                        <!-- edit -->
                        <p:commandLink title="#{msg['dialog.contactDialog.data.edit']}"
                                       actionListener="#{dialog.contactNotificationDialog.initAndPrepareBean(contactDialog.task, contactHolder.contact)}">
                            <i class="fa fa-edit"/>
                            <p:ajax event="dialogReturn" update="@form"
                                    listener="#{contactDialog.onSubDialogReturn}"/>
                        </p:commandLink>

                        <!-- remove, only if no notification was performed -->
                        <p:commandLink
                                title="#{msg['dialog.contactDialog.data.remove']}"
                                disabled="#{!contactHolder.deletable}" update="@form"
                                actionListener="#{contactDialog.removeContact(contactHolder.reportIntent)}">
                            <i class="fa fa-times"/>
                        </p:commandLink>

                        <!-- show detailed infos -->
                        <p:commandLink
                                update="@form"
                                title="#{msg['dialog.contactDialog.data.info']}"
                                disabled="#{!contactHolder.detailsPresent}"
                                actionListener="#{contactHolder.toggleDetails}">
                            <i class="fa fa-info-circle"/>
                        </p:commandLink>
                    </p:column>

                    <!-- detailed data -->
                    <p:summaryRow>
                        <p:column colspan="4" style="text-align:right" rendered="#{contactHolder.showDetails}">
                            <p:repeat value="#{contactHolder.reportIntentStatus.diagnosisBearers}"
                                      var="diagnosisBearer">
                                <h:panelGrid columns="2" columnClasses="columnWidth250">
                                    <!-- diagnosis name -->
                                    <h:panelGroup>
                                        <i class="fa fa-eyedropper"/>
                                        <h:outputLabel value="#{diagnosisBearer.diagnosisName}"/>
                                    </h:panelGroup>

                                    <!-- notification status -->
                                    <p:dataTable value="#{diagnosisBearer.reportIntentNotificationBearers}"
                                                 style="width: 600px"
                                                 styleClass="plainHistoTable"
                                                 var="reportIntentBearer">

                                        <!-- type icon -->
                                        <p:column>
                                            <h:panelGroup>
                                                <pe:switch value="#{reportIntentBearer.type}">
                                                    <!-- mail -->
                                                    <pe:case value="#{notificationTyp.EMAIL}">
                                                        <i class="fa fa-envelope icon-grey"/>
                                                    </pe:case>
                                                    <!-- fax -->

                                                    <pe:case value="#{notificationTyp.FAX}">
                                                        <i class="fa fa-fax icon-grey"/>
                                                    </pe:case>
                                                    <!-- letter -->
                                                    <pe:case value="#{notificationTyp.LETTER}">
                                                        <i class="fa fa-pencil-square-o icon-grey"/>
                                                    </pe:case>
                                                    <!-- phone -->
                                                    <pe:case value="#{notificationTyp.PHONE}">
                                                        <i class="fa fa-phone icon-grey"/>
                                                    </pe:case>
                                                    <!-- print -->
                                                    <pe:case value="#{notificationTyp.PRINT}">
                                                        <i class="fa fa-print icon-grey"/>
                                                    </pe:case>
                                                    <!-- default -->
                                                    <pe:defaultCase>
                                                        <i class="fa fa-question icon-grey"/>
                                                    </pe:defaultCase>
                                                </pe:switch>

                                                <!-- name -->
                                                <h:outputText
                                                        style="margin-left: 5px"
                                                        value="#{msg['enum.notificationType.'.concat(reportIntentBearer.type)]}"/>
                                            </h:panelGroup>
                                        </p:column>

                                        <!-- attempts -->
                                        <p:column>
                                            <h:outputFormat value="#{msg['dialog.contactDialog.data.attempts']}">
                                                <f:param value="#{reportIntentBearer.attempts}"/>
                                            </h:outputFormat>
                                        </p:column>

                                        <!-- successes -->
                                        <p:column>
                                            <h:outputFormat value="#{msg['dialog.contactDialog.data.success']}">
                                                <f:param value="#{reportIntentBearer.successes}"/>
                                            </h:outputFormat>
                                        </p:column>

                                        <!-- failedAttempts -->
                                        <p:column>
                                            <h:outputFormat
                                                    value="#{msg['dialog.contactDialog.data.failedAttempts']}">
                                                <f:param value="#{reportIntentBearer.failedAttempts}"/>
                                            </h:outputFormat>
                                        </p:column>

                                        <!-- performed -->
                                        <p:column>
                                            <ui:fragment rendered="#{reportIntentBearer.attempts != 0}">
                                                <h:panelGroup>
                                                    <h:outputLabel
                                                            value="#{msg['dialog.contactDialog.data.performed']}"/>
                                                    <i class="fa fa-fw #{reportIntentBearer.success ? 'fa-check-circle icon-green' :'fa-exclamation-triangle icon-red'}"
                                                       title="#{reportIntentBearer.success ? msg['dialog.contactDialog.data.performedSuccess'] : msg['dialog.contactDialog.data.performedFailed'] }"/>
                                                </h:panelGroup>
                                            </ui:fragment>
                                        </p:column>
                                    </p:dataTable>
                                </h:panelGrid>
                            </p:repeat>
                        </p:column>
                    </p:summaryRow>


                </p:dataTable>

            </h:panelGrid>
        </div>


        <div class="buttonContainer">
            <h:panelGrid columns="2">

                <h:panelGrid columns="1" styleClass="left">
                </h:panelGrid>

                <h:panelGrid columns="2" styleClass="right">
                    <!-- add new contact -->
                    <p:commandButton value="#{msg['dialog.contact.add']}"
                                     icon="fa fa-fw fa-user-plus"
                                     actionListener="#{contactDialog.openNewContactDialog()}">
                        <p:ajax event="dialogReturn" update="@form"
                                listener="#{contactDialog.onSubDialogReturn}"/>
                    </p:commandButton>

                    <!-- close -->
                    <p:commandButton value="#{msg['general.close']}"
                                     icon="fa fa-fw fa-times-circle" id="closeBtn"
                                     actionListener="#{contactDialog.hideDialog()}"/>
                </h:panelGrid>
            </h:panelGrid>
        </div>

    </h:form>
</h:body>
</html>
