<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
>

<h:head>
    <title><h:outputFormat
            value="#{msg['dialog.contacts.headline']}"/></title>
    <h:outputStylesheet name="style.css" value="style.css" library="css"/>
    <h:outputStylesheet name="specificStyle.css" value="specificStyle.css"
                        library="css"/>
    <h:outputScript library="scripts" name="commonFunctions.js"/>
</h:head>

<h:body styleClass="histoDialogStyle">
    <h:form id="dialogContent">

        <div class="dialogHeader">
            <h:panelGrid style="width:100%;" columns="2">
                <h:outputLabel value="#{msg['dialog.contacts.headline']}"/>
                <p:commandLink title="#{msg['general.close']}" style="float:right;"
                               onclick="$('#dialogContent\\:closeBtn').click();return false;">
                    <i class="fa fa-fw fa-times"/>
                </p:commandLink>
            </h:panelGrid>
        </div>

        <div class="dialogContent">

            <h:panelGrid columns="1" styleClass="defaultHistoTable">

                <p:dataTable var="contactHolder" styleClass="defaultHistoDataTable"
                             id="contactDatas" scrollable="true" scrollHeight="480"
                             sortBy="#{contactHolder.item.id}"
                             value="#{contactDialog.reportIntents}">

                    <!-- Name -->
                    <p:column headerText="#{msg['dialog.contacts.table.name']}"
                              style="width: auto !important"
                              filterBy="#{contactHolder.item.person.lastName}"
                              filterMatchMode="contains">
                        <h:outputText
                                value="#{contactHolder.item.person.getFullName()}"/>
                    </p:column>

                    <p:column headerText="#{msg['dialog.contacts.table.function']}"
                              style="width:15% !important">
                        <h:outputText
                                value="#{msg['enum.contactRole.'.concat(contactHolder.item.role)]}"/>
                    </p:column>

                    <p:column headerText="#{msg['dialog.contacts.table.notification']}">

                        <p:dataList var="notifications"
                                    rendered="#{contactHolder.item.notifications.size() gt 0}"
                                    styleClass="histoDataList"
                                    value="#{contactHolder.item.notifications}">
                            <p:column>
                                <ui:fragment
                                        rendered="#{notifications.notificationTyp eq 'EMAIL'}">
                                    <i class="fa fa-envelope icon-grey"/>
                                </ui:fragment>

                                <ui:fragment
                                        rendered="#{notifications.notificationTyp eq 'FAX'}">
                                    <i class="fa fa-fax icon-grey"/>
                                </ui:fragment>

                                <ui:fragment
                                        rendered="#{notifications.notificationTyp eq 'LETTER'}">
                                    <i class="fa fa-pencil-square-o icon-grey"/>
                                </ui:fragment>

                                <ui:fragment
                                        rendered="#{notifications.notificationTyp eq 'PHONE'}">
                                    <i class="fa fa-phone icon-grey"/>
                                </ui:fragment>

                                <ui:fragment
                                        rendered="#{notifications.notificationTyp eq 'PRINT'}">
                                    <i class="fa fa-print icon-grey"/>
                                </ui:fragment>

                                <span style="margin-left: 10px;">
                                    <h:outputText
                                            value="#{msg['enum.notificationType.'.concat(notifications.notificationTyp)]}"/>
								</span>


                            </p:column>
                        </p:dataList>
                    </p:column>

                    <!-- options -->
                    <p:column headerText="" style="width:30px !important">
                        <!-- edit -->
                        <p:commandLink title="#{msg['dialog.contacts.change']}"
                                       actionListener="#{dialog.contactNotificationDialog.initAndPrepareBean(contactDialog.task, contactHolder.contact)}">
                            <i class="fa fa-wrench"/>
                            <p:ajax event="dialogReturn" update="@form"
                                    listener="#{contactDialog.onSubDialogReturn}"/>
                        </p:commandLink>

                        <!-- remove, only if no notification was performed -->
                        <p:commandLink
                                title="#{contactHolder.deletable ? msg['dialog.contacts.remove']: msg['dialog.contacts.remove.notPossible']}"
                                disabled="#{!contactHolder.deletable}" update="@form">

                            <f:actionListener
                                    binding="#{contactDialog.update()}"/>
                            <i class="fa fa-times"/>
                        </p:commandLink>
                    </p:column>

                    <p:summaryRow>
                        <p:column colspan="4" style="text-align:right">
                            <ui:repeat value="#{contactHolder.reportIntentStatus.diagnosisBearers}"
                                       var="diagnosisBearer">
                                <h:panelGrid columns="2">
                                    <!-- diagnosis name -->
                                    <h:panelGroup>
                                        <i class="fa fa-eyedropper"/>
                                        <h:outputLabel value="#{diagnosisBearer.diagnosisName}"/>
                                    </h:panelGroup>

                                    <!-- notification status -->
                                    <p:dataTable value="#{diagnosisBearer.reportIntentNotificationBearers}"
                                                 styleClass="plainHistoTable"
                                                 var="reportIntentBearer">
                                        <p:column>
                                            <!-- type icon -->
                                            <h:panelGroup>
                                                <p:importEnum
                                                        type="com.patho.main.model.patient.notification.NotificationTyp"
                                                        var="notificationTyp" allSuffix="ALL_ENUM_VALUES"/>

                                                <pe:switch value="#{reportIntentBearer.type}">
                                                    <!-- mail -->
                                                    <pe:case value="#{notificationTyp.EMAIL}">
                                                        <i class="fa fa-envelope icon-grey"/>
                                                    </pe:case>
                                                    <!-- fax -->

                                                    <pe:case value="#{notificationTyp.FAX}">
                                                        <i class="fa fa-fax icon-grey"/>
                                                    </pe:case>
                                                    <!-- letter -->
                                                    <pe:case value="#{notificationTyp.LETTER}">
                                                        <i class="fa fa-pencil-square-o icon-grey"/>
                                                    </pe:case>
                                                    <!-- phone -->
                                                    <pe:case value="#{notificationTyp.PHONE}">
                                                        <i class="fa fa-phone icon-grey"/>
                                                    </pe:case>
                                                    <!-- print -->
                                                    <pe:case value="#{notificationTyp.PRINT}">
                                                        <i class="fa fa-print icon-grey"/>
                                                    </pe:case>
                                                    <!-- default -->
                                                    <pe:defaultCase>
                                                        <i class="fa fa-question icon-grey"/>
                                                    </pe:defaultCase>

                                                </pe:switch>

                                            </h:panelGroup>
                                        </p:column>
                                        <p:column>
                                            <!-- attempts -->
                                            <h:outputFormat value="#{msg['body.receiptlog.contact.overview.attempts']}">
                                                <f:param value="#{bearer.attempts}"/>
                                            </h:outputFormat>
                                        </p:column>
                                        <p:column>
                                            <!-- successes -->
                                            <h:outputFormat value="#{msg['body.receiptlog.contact.overview.success']}">
                                                <f:param value="#{bearer.successes}"/>
                                            </h:outputFormat>
                                        </p:column>
                                        <p:column>
                                            <!-- failedAttempts -->
                                            <h:outputFormat
                                                    value="#{msg['body.receiptlog.contact.overview.failedAttampts']}">
                                                <f:param value="#{bearer.failedAttempts}"/>
                                            </h:outputFormat>
                                        </p:column>
                                        <p:column>
                                            <!-- performed -->
                                            <ui:fragment rendered="#{bearer.attempts != 0}">
                                                <h:panelGroup>
                                                    <h:outputLabel
                                                            value="#{msg['body.receiptlog.contact.overview.performed']}"/>
                                                    <i class="fa fa-fw #{bearer.success ? 'fa-check-circle icon-green' :'fa-exclamation-triangle icon-red'}"
                                                       title="#{msg['body.statiningView.idManuallyAltered']}"/>
                                                </h:panelGroup>
                                            </ui:fragment>

                                            <ui:fragment rendered="#{notificationBearer.attempts == 0}">
                                                <h:panelGroup>
                                                    <h:outputLabel
                                                            value="#{msg['body.receiptlog.contact.overview.performed']}"/>
                                                    <i class="fa fa-fw fa-minus"/>
                                                </h:panelGroup>
                                            </ui:fragment>
                                        </p:column>
                                    </p:dataTable>
                                </h:panelGrid>
                            </ui:repeat>
                        </p:column>
                    </p:summaryRow>


                </p:dataTable>

            </h:panelGrid>
        </div>


        <div class="buttonContainer">
            <h:panelGrid columns="2">

                <h:panelGrid columns="1" styleClass="left">
                </h:panelGrid>

                <h:panelGrid columns="2" styleClass="right">
                    <!-- add new contact -->
                    <p:commandButton value="#{msg['dialog.contact.add']}"
                                     icon="fa fa-fw fa-user-plus"
                                     actionListener="#{contactDialog.openNewContactDialog()}">
                        <p:ajax event="dialogReturn" update="@form"
                                listener="#{contactDialog.onSubDialogReturn}"/>
                    </p:commandButton>

                    <!-- close -->
                    <p:commandButton value="#{msg['general.close']}"
                                     icon="fa fa-fw fa-times-circle" id="closeBtn"
                                     actionListener="#{contactDialog.hideDialog()}"/>
                </h:panelGrid>
            </h:panelGrid>
        </div>

    </h:form>
</h:body>
</html>
