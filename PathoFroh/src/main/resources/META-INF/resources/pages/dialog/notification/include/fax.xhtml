<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:histo="http://java.sun.com/jsf/composite/components">

    <p:outputPanel styleClass="headerPannel">
        <h:outputLabel value="#{msg['dialog.notificationDialog.fax.headline']}"/>
    </p:outputPanel>


    <p:outputPanel styleClass="bodyPannel">
        <h:panelGrid columns="2" styleClass="defaultHistoTable"
                     columnClasses="columnWidth150 columnTop, ">

            <!-- Use fax -->
            <h:outputLabel value="#{msg['dialog.notificationDialog.fax.use.text']}"
                           title="#{msg['dialog.notificationDialog.fax.use.info']}"
                           styleClass="bigFont"/>
            <p:selectBooleanCheckbox
                    value="#{notificationDialog.faxTab.useNotification}"
                    title="#{msg['dialog.notificationDialog.fax.use.info']}">
                <p:ajax event="change" process="@form" update="@form"/>
            </p:selectBooleanCheckbox>

            <!-- Send fax -->
            <h:outputLabel value="#{msg['dialog.notificationDialog.fax.send.text']}"
                           title="#{msg['dialog.notificationDialog.fax.send.info']}"
                           styleClass="bigFont"/>
            <p:selectBooleanCheckbox
                    value="#{notificationDialog.faxTab.sendFax}"
                    title="#{msg['dialog.notificationDialog.fax.send.info']}"
                    disabled="#{!notificationDialog.faxTab.useNotification}">
                <p:ajax event="change" process="@form" update="@form"/>
            </p:selectBooleanCheckbox>

            <!-- print -->
            <h:outputLabel value="#{msg['dialog.notificationDialog.fax.print.text']}"
                           title="#{msg['dialog.notificationDialog.fax.print.info']}"
                           styleClass="bigFont"/>
            <p:selectBooleanCheckbox
                    disabled="#{!notificationDialog.faxTab.useNotification}"
                    value="#{notificationDialog.faxTab.printFax}"
                    title="#{msg['dialog.notificationDialog.fax.print.info']}">
                <p:ajax event="change" process="@form" update="@form"/>
            </p:selectBooleanCheckbox>

            <!-- Individual address -->
            <h:outputLabel
                    value="#{msg['dialog.notificationDialog.fax.individualAddress.text']}"
                    title="#{msg['dialog.notificationDialog.fax.individualAddress.info']}"
                    styleClass="bigFont"/>
            <p:selectBooleanCheckbox
                    disabled="#{!notificationDialog.faxTab.useNotification}"
                    value="#{notificationDialog.faxTab.individualAddresses}"
                    title="#{msg['dialog.notificationDialog.fax.individualAddress.info']}">
                <p:ajax event="change" process="@this" update="@form"/>
            </p:selectBooleanCheckbox>

            <!-- pdf template -->
            <h:outputLabel
                    value="#{msg['dialog.notificationDialog.fax.template.text']}"
                    title="#{msg['dialog.notificationDialog.fax.template.info']}"
                    styleClass="bigFont"/>

            <p:selectOneMenu
                    title="#{msg['dialog.notificationDialog.fax.template.info']}"
                    value="#{notificationDialog.faxTab.selectedTemplate}"
                    converter="#{notificationDialog.faxTab.templatesTransformer}"
                    disabled="#{!notificationDialog.faxTab.useNotification}">


                <f:selectItem itemValue="#{null}"
                              itemLabel="#{msg['dialog.notificationDialog.fax.template.none']}"/>

                <f:selectItems
                        value="#{notificationDialog.faxTab.templates}"
                        var="template" itemLabel="#{template.name}" itemValue="#{template}"/>

                <p:ajax update="@this" event="change" process="@this"/>
            </p:selectOneMenu>

            <!-- receiver -->
            <h:outputLabel value="#{msg['dialog.notificationDialog.fax.receiverTable.text']}"
                           styleClass="bigFont"/>

            <p:dataTable var="reportIntentNotificationBearer" scrollable="true" scrollHeight="160"
                         style="width:96%" id="notificationTable" styleClass="defaultHistoDataTable"
                         value="#{notificationDialog.faxTab.reportIntentStatus.reportNotificationIntents}"
                         sortBy="#{reportIntentNotificationBearer.status}">

                <!-- header sorting by status -->
                <p:headerRow>
                    <p:column colspan="5">
                        <h:outputText
                                value="#{msg['dialog.notificationDialog.notificationStatus.'.concat(reportIntentNotificationBearer.status)]}"/>
                    </p:column>
                </p:headerRow>

                <!-- perform notification on user -->
                <p:column style="width:7%;text-align:center;">
                    <f:facet name="header">
                        <i class="fa fa-check-circle-o "
                           title="#{msg['dialog.notificationDialog.fax.receiverTable.performe']}"/>
                    </f:facet>

                    <p:selectBooleanCheckbox
                            disabled="#{!notificationDialog.faxTab.useNotification or !reportIntentNotificationBearer.renderInactiveButton}"
                            title="#{msg['dialog.notificationDialog.fax.receiverTable.performe']}"
                            value="#{reportIntentNotificationBearer.performNotification}">
                        <p:ajax event="change" update="@form"/>
                    </p:selectBooleanCheckbox>
                </p:column>

                <!-- name of receiver -->
                <p:column
                        headerText="#{msg['dialog.notificationDialog.fax.receiverTable.name']}"
                        style="width:auto">
                    <h:outputText value="#{reportIntentNotificationBearer.reportIntent.person.getFullName()}"/>
                </p:column>

                <!-- fax number -->
                <p:column
                        headerText="#{msg['dialog.notificationDialog.fax.receiverTable.fax']}"
                        style="width:auto">
                    <p:inputText value="#{reportIntentNotificationBearer.contactAddress}"
                                 disabled="#{!notificationDialog.faxTab.useNotification or !reportIntentNotificationBearer.performNotification}"
                                 style="width:96%"/>
                </p:column>


                <!-- options -->
                <p:column style="width:10%;" styleClass="centerChildElements centerHeaderChildElements">
                    <f:facet name="header">
                        <i class="fa fa-file-pdf-o"
                           title="#{msg['dialog.notificationDialog.fax.receiverTable.pdf.info']}"/>
                    </f:facet>

                    <!-- add pdf, if pdf == null -->
                    <p:commandLink
                            rendered="#{reportIntentNotificationBearer.pdf eq null and reportIntentNotificationBearer.performNotification}"
                            disabled="#{!notificationDialog.faxTab.useNotification}"
                            title="#{msg['dialog.notificationDialog.fax.receiverTable.pdf.select']}"
                            execute="@this"
                            actionListener="#{notificationDialog.openSelectPDFDialog(notificationDialog.task, reportIntentNotificationBearer.reportIntent)}">

                        <!-- current container is passed to the dialogReturn methode -->
                        <f:attribute name="container" value="#{reportIntentNotificationBearer}"/>

                        <p:ajax event="dialogReturn" update="@form" process="@form"
                                listener="#{notificationDialog.onSubDialogReturn}">
                        </p:ajax>

                        <i class="fa fa-fw fa-file-pdf-o"/>
                    </p:commandLink>

                    <!-- show pdf, if pdf != null -->
                    <p:commandLink
                            rendered="#{reportIntentNotificationBearer.pdf ne null and reportIntentNotificationBearer.performNotification}"
                            title="#{msg['dialog.notificationDialog.fax.receiverTable.pdf.view']}"
                            execute="@this"
                            disabled="#{!notificationDialog.faxTab.useNotification}"
                            actionListener="#{dialog.pdfOrganizer.initAndPrepareBean(notificationDialog.task.patient).viewMode().setPDFToDisplay(reportIntentNotificationBearer.pdf)}">

                        <i class="fa fa-search icon-grey"/>
                    </p:commandLink>

                    <!-- remove pdf, if pdf != null -->
                    <p:commandLink style="margin-left: 10px;"
                                   rendered="#{reportIntentNotificationBearer.pdf ne null and reportIntentNotificationBearer.performNotification}"
                                   title="#{msg['dialog.notificationDialog.fax.receiverTable.pdf.remove']}"
                                   execute="@this"
                                   disabled="#{!notificationDialog.faxTab.useNotification}"
                                   update="@form" actionListener="#{reportIntentNotificationBearer.setPdf(null)}">

                        <i class="fa fa-close icon-grey"/>
                    </p:commandLink>

                </p:column>

                <!-- enable and disable -->
                <p:column style="width: 5%" styleClass="centerChildElements centerHeaderChildElements">
                    <f:facet name="header">
                        <i class="fa fa-stop"
                           title="#{msg['dialog.notificationDialog.fax.receiverTable.active.headline']}"/>
                    </f:facet>
                    <!-- enable button -->
                    <p:commandLink
                            rendered="#{reportIntentNotificationBearer.renderActiveButton}"
                            title="#{msg['dialog.notificationDialog.fax.receiverTable.active.enable']}"
                            execute="@this"
                            disabled="#{!notificationDialog.faxTab.useNotification}"
                            update="@form"
                            actionListener="#{notificationDialog.disableNotification(reportIntentNotificationBearer.reportIntentNotification, true)}">
                        <i class="fa fa-undo icon-grey"/>
                    </p:commandLink>

                    <!-- disable button -->
                    <p:commandLink
                            rendered="#{reportIntentNotificationBearer.renderInactiveButton}"
                            title="#{msg['dialog.notificationDialog.fax.receiverTable.active.disable']}"
                            execute="@this"
                            disabled="#{!notificationDialog.faxTab.useNotification}"
                            update="@form"
                            actionListener="#{notificationDialog.disableNotification(reportIntentNotificationBearer.reportIntentNotification, false)}">
                        <i class="fa fa-times-circle icon-red"/>
                    </p:commandLink>
                </p:column>
            </p:dataTable>
        </h:panelGrid>
    </p:outputPanel>

    <!-- navigation bar -->
    <histo:notificationDialogNavigationBar/>
</ui:composition>
